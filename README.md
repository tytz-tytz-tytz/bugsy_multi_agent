
# Bugsy Multi-Agent: Система автоматизированного тест-дизайна

## 1. Введение

**Bugsy Multi-Agent** — это исследовательская и прикладная платформа для автоматизации процесса тест-дизайна на основе многоагентной архитектуры и LLM-моделей.  
Система предназначена для преобразования неструктурированной документации в структурированные тестовые артефакты и сценарии:

- **TestingContext** — нормализованный контекст, извлечённый из документации,  
- **Attributes** — атомарные тестируемые требования,  
- **Scenarios** — тестовые сценарии, покрывающие сформированные требования.

Система построена вокруг строгих JSON-контрактов между агентами и обеспечивает воспроизводимость, детерминизм и устойчивость к ошибкам LLM за счёт fallback‑логики.

---

## 2. Взаимодействие с OntologyRAG

Bugsy Multi-Agent не выполняет семантический поиск самостоятельно.  
Входные данные поставляются внешним компонентом [OntologyRAG](https://github.com/tytz-tytz-tytz/ontologyRAG), который:

- извлекает релевантные сегменты документации,
- ранжирует секции,
- возвращает агрегированный контекст в виде структурированного JSON.

Эти данные сохраняются в каталоге:

```
data/contexts/
```

и выступают исходной точкой для пайплайна Bugsy.

---

## 3. Общий конвейер обработки

Полный рабочий процесс выглядит следующим образом:

```
raw_document_context (из OntologyRAG)
        ↓
OntologyRAG Retriever Agent
        ↓ TestingContext
Attribute Generator Agent
        ↓ attributes.json
Attribute Validator Agent
Attribute Coverage Checker
        ↓
Scenario Generator Agent
        ↓ scenarios.json
Scenario Validator Agent (опционально)
Scenario Coverage Checker (опционально)
```

Каждый агент:

1. получает входные данные в виде JSON,
2. формирует LLM‑промпт,
3. вызывает DeepSeek API (или использует fallback‑эвристику),
4. возвращает строго типизированный JSON-объект,
5. сохраняет результат в `data/outputs/<название_агента>/`.

---

## 4. Структура репозитория

```
bugsy_multi_agent/
├─ data/
│  ├─ contexts/                        # Сырые входы OntologyRAG
│  ├─ outputs/
│  │   ├─ ontologyRAG_retriever/      # TestingContext
│  │   ├─ attribute_generator/        # Attributes
│  │   ├─ attribute_validator/        # ValidationReport
│  │   ├─ attribute_coverage_checker/ # CoverageReport
│  │   ├─ scenario_generator/         # Scenarios
│  │   ├─ scenario_validator/         # ValidationReport
│  │   └─ scenario_coverage_checker/  # CoverageReport
│  └─ queries.json                    # Человекочитаемые формулировки запросов
│
├─ src/bugsy_multi_agent/
│  ├─ agents/                          # Реализация многоагентной логики
│  ├─ llm/                             # Промптинг + DeepSeek API‑клиент
│  ├─ models/                          # Pydantic-модели (контракты данных)
│  ├─ data_access/                     # Слои IO, хранилища артефактов
│  ├─ orchestration/                   # Orchestrator + Pipeline
│  ├─ config/                          # Настройки и пути
│  └─ main.py                          # CLI-интерфейс
```

---

## 5. Основные модели данных

### 5.1. TestingContext

Нормализованное представление контекста, включающее:

- `query` — текст пользовательского запроса,  
- `focus_summary` — краткое резюме того, что требуется протестировать,  
- `core_passages` — ключевые секции документации,  
- `supporting_passages` — вспомогательная информация,  
- `discarded_sections` — нерелевантные сегменты,  
- `domain_entities` — доменные сущности,  
- `hints_for_tests` — подсказки для построения тестов.

### 5.2. Attribute (тестовое требование)

Каждое требование является **атомарным** и содержит:

- уникальный идентификатор (`id`),
- краткое имя (`name`),
- тип (`functional | business_rule | ui | negative`),
- приоритет (`P1 | P2 | P3`),
- описание,
- позитивный и негативный пример поведения,
- ссылки на секции-источники (`source_section_ids`),
- цитаты из документации (`source_quotes`).

### 5.3. Scenario

Структурированный тестовый сценарий:

- `id` — уникальный идентификатор сценария,
- `title`,
- `steps` — упорядоченный список действий,
- `expected_result`,
- `attributes_covered` — список идентификаторов атрибутов.

---

## 6. LLM‑интеграция (DeepSeek)

Система использует DeepSeek API как LLM‑движок.  
Клиент работает через OpenAI‑совместимый интерфейс (модель *deepseek-chat*).

Особенности интеграции:

- каждый агент формирует строгий JSON‑ориентированный промпт,
- используется парсер результата, способный извлекать JSON даже при наличии разметки,
- при ошибке парсинга система автоматически переключается на локальный fallback.

---

## 7. Использование

### 7.1. Настройка окружения

Установить API‑ключ DeepSeek:

```
setx DEEPSEEK_API_KEY "ваш_ключ"
```

### 7.2. Запуск полного пайплайна

```
python -m bugsy_multi_agent.main run query_1 --full
```

После завершения работы агенты создадут полный комплект артефактов в `data/outputs/`.

---

## 8. Дизайн‑принципы

- **Модульность** — каждый агент независим и заменяем.  
- **Прозрачность** — строгие форматы входа и выхода на основе схем.  
- **Детерминизм** — одинаковый вход → одинаковый вывод при одинаковых условиях LLM.  
- **Устойчивость** — пайплайн завершается даже при сбоях LLM.  
- **Повторяемость экспериментов** — все промежуточные результаты сохраняются.

---

## 9. Назначение системы

Система создавалась для:

- автоматизации процесса тест-дизайна,  
- извлечения требований из пользовательской документации,  
- планирования тестового покрытия,  
- генерации сценариев для ручного и автоматизированного тестирования,  
- проведения исследований в области применения многоагентных LLM для QA.

Bugsy Multi-Agent может использоваться как самостоятельный инструмент, так и как часть более крупной цепочки ML/QA‑платформ.

