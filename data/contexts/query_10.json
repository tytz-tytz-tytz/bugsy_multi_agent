{
  "query": "создание и настройки виджета",
  "section_candidates": [
    {
      "section_id": "section_ch1467",
      "title": "Настройка виджетов подключения к боту для сайта компании",
      "text": "Настройка виджетов подключения к боту для сайта компании\nВиджеты предназначены для того, чтобы клиенты могли перейти к диалогу с ботом или оператором компании прямо со страницы сайта компании (см. Рисунок 160). Таким образом, в частности, решается задача накопления аудитории.\nРисунок 160 — Расположение виджетов на странице сайта\n123 Виджет позволяет перейти к диалогу с ботом, используя один из поддерживаемых мессенджеров на выбор.\nДля создания виджета необходимо:\n1. Выбрать в верхнем правом углу окна бота, для которого будет создаваться виджет.\n2. Перейти в раздел «Инструменты роста» и на вкладке «Виджеты» нажать на кнопку «+ Создать» в правом верхнем углу (см. Рисунок 161).\nРисунок 161 — Переход к созданию виджета\n3. Ввести название виджета и нажать на кнопку «Создать» (см. Рисунок 162).\nРисунок 162 — Ввод названия виджета\n4. В списке виджетов нажать на название только что созданного виджета для редактирования его настроек (см. Рисунок 163).\nНастройки виджета разделены на две вкладки «Desktop» и «Mobile» и позволяют, соответственно, задать отображение для десктопной и мобильной версии. Каждая версия настраивается независимо и имеет одинаковый набор настроек.\nРисунок 163 — Настройка виджета\nВажно!\nТип отображения (Desktop или Mobile) определяется не типом устройства, на котором открыта страница с виджетом, а шириной окна браузера\n. На узких экранах мобильных устройств будет отображаться мобильная версия. При этом ее можно также увидеть на широком экране, если сузить окно браузера с сайтом, на котором установлен виджет. И наоборот, на планшетах с достаточной шириной экрана будет выводиться десктопная версия.\nПоле «Deeplink» определяет, какой диплинк будет передаваться боту при переходе клиента к диалогу с ботом через этот виджет. Так, например, можно настроить виджет, который будет переводить клиентов в заданный канал. Для этого нужно выбрать deeplink, переводящий в этот канал (см. Рисунок 164).\nЗначение ширины, различающее десктопное и мобильное отображения, составляет 640 пикселей; высоты — 560 пикселей.\nРисунок 164 — Выбор диплинка для передачи боту\nСписок мессенджеров в нижней части настроек определяет, какие мессенджеры будут доступны клиентам (см. Рисунок 165). Если какой-то мессенджер недоступен для выбора, это означает, что интеграция для этого мессенджера в настройках бота не настроена.\n* Рисунок 165 — Список доступных мессенджеров в настройках виджета\nДля установки созданного виджета на страницу сайта нужно нажать на кнопку «Документация» в правом верхнем углу и поместить предоставленный там js-код (см. Рисунок 166) на эту страницу.\nРисунок 166 — Код виджета для вставки на страницу сайта\n126 После этого посетители страницы смогут пользоваться созданным виджетом.\nВажно!\nПри изменении настроек виджета не следует менять js-код, добавленный на страницу сайта.\nПри необходимости отключить виджет это можно сделать переключателем слева от названия виджета. Также отдельно могут быть отключены мобильная или десктопная версии виджета. При временном отключении виджета убирать js-код со страницы сайта также не обязательно (см. Рисунок 167).\nРисунок 167 — Элементы интерфейса для включения и отключения виджета в целом и для отдельных типов отображения",
      "score": 0.7125729870796202,
      "node_ids": [
        "chunk_ch1471",
        "chunk_ch1477",
        "chunk_ch1475",
        "chunk_ch1472",
        "chunk_ch1498",
        "chunk_ch1491",
        "chunk_ch1478",
        "chunk_ch1474",
        "chunk_ch1480",
        "chunk_ch1468",
        "chunk_ch1467",
        "chunk_ch1489",
        "chunk_ch1490",
        "chunk_ch1482",
        "chunk_ch1484",
        "chunk_ch1492",
        "chunk_ch1493",
        "chunk_ch1494",
        "chunk_ch1469",
        "chunk_ch1487",
        "chunk_ch1497",
        "chunk_ch1470",
        "chunk_ch1476"
      ]
    },
    {
      "section_id": "section_ch0113",
      "title": "Настройка сценария рассылки",
      "text": "Настройка сценария рассылки\nКонструктор позволяет задать сценарий рассылки, который будет выполняться для каждого клиента из аудитории рассылки.\nСценарий рассылки состоит из:\n• события Start;\n• блоков действий;\n• связей между блоками действий.\nПри создании рассылки в конструкторе автоматически создается событие Start, которое является начальной точкой выполнения сценария рассылки. Также в редакторе отображается кнопка «Добавить блок», при помощи которой в рассылку добавляются блоки действий. События и блоки действий соединяются при помощи мыши, образуя связи.\nВ простейшем случае сценарий рассылки представляет собой событие Start, связанное с одним блоком действий (см. Рисунок 19).\nРисунок 19 — Создан сценарий простейшей рассылки",
      "score": 0.6017447066307067,
      "node_ids": [
        "chunk_ch0113",
        "chunk_ch0119",
        "chunk_ch0114",
        "chunk_ch0115",
        "chunk_ch0122",
        "chunk_ch0120",
        "chunk_ch0116"
      ]
    },
    {
      "section_id": "section_ch0450",
      "title": "Настройка условий начала рассылки",
      "text": "Настройка условий начала рассылки\nНастройки, задаваемые на вкладке «Условия начала рассылки», определяют правила запуска для клиентов из аудитории рассылки. Эти настройки можно разделить на четыре части (см. Рисунок 75):\n• Условия начала рассылки для клиентов (1);\n• Время, после которого рассылка не начнется для клиента (2);\n• Время, когда никакие действия рассылки не выполняются для клиента (3);\n• Расширенные настройки (4).\nРисунок 75 — Настройки условий начала рассылки\nВажно отметить, что условия начала задаются до первого запуска рассылки в состоянии «Не запущена» (см. подробнее в разделе\nВозможные состояния рассылки\n). После запуска рассылки изменить условия начала нельзя. Это касается следующих изменений:\n• изменение условия начала рассылки (т. е., например, перехода от тега к событию),\n• изменение тега или события, которые начинают рассылку,\n• изменение времени, в которое начнется рассылка (для рассылок с фиксированной аудиторией, которые начинаются в заданное время);\n• изменение времени, после которого рассылка не начнется для клиента.\nЕсли нужно изменить эти параметры, следует клонировать рассылку и внести изменения до запуска рассылки, см. подробнее в разделе\nИзменение условий начала и аудитории для запущенной рассылки\n.",
      "score": 0.5832991552352904,
      "node_ids": [
        "chunk_ch0450",
        "chunk_ch0451",
        "chunk_ch0466",
        "chunk_ch0465",
        "chunk_ch0457",
        "chunk_ch0460",
        "chunk_ch0458",
        "chunk_ch0452",
        "chunk_ch0459",
        "chunk_ch0461",
        "chunk_ch0467"
      ]
    },
    {
      "section_id": "section_ch0468",
      "title": "Условия начала",
      "text": "Условия начала\nНачать сразу после запуска рассылки\nПри выборе этой настройки рассылка начинает выполняться для всех клиентов из аудитории рассылки сразу после ее запуска. Аудитория рассылки фиксирована (задается до запуска рассылки) и не может быть изменена до остановки рассылки.\nПосле того, как рассылка начнется для всех клиентов она автоматически переходит в пассивный режим. В этом состоянии продолжается выполнение сценария рассылки для клиентов.\nНачинать в заданное время\nПри выборе этой настройки рассылка стартует для всех клиентов из аудитории рассылки в заданное маркетологом время.\nПрочие условия аналогичны предыдущей опции.\nНачинать в заданное время и отправлять равномерно\nЭта настройка позволяет автоматически разделить аудиторию и отправлять рассылки одинаковыми «порциями». Это может быть полезно, например, чтобы сделать нагрузку на операторов, принимающих заявки от клиентов из рассылки, более-менее равномерной. Как и в двух предыдущих случаях аудитория рассылки фиксирована и задается до ее запуска.\nСхема работы рассылки при выборе данной опции следующая: все клиенты аудитории разделяются на подгруппы заданного размера, например, по 500 человек. Рассылка начинается не для всех клиентов из аудитории сразу, как для предыдущих двух вариантов, а только для клиентов одной подгруппы. Далее бот ждет заданное время, и начинает рассылку для следующей подгруппы клиентов. При этом рассылка начинается для подгрупп клиентов только в заданное время, например, «вторник-четверг с 11 до 16». В остальное время рассылка не начинается.\nПри выборе этой настройки отображаются дополнительные опции (см. Рисунок 76):\n• Даты начала и окончания — определяют время, когда рассылка начнется\nдля первой «порции» клиентов и когда она перестанет начинаться. Иными словами, если для какого-то клиента из аудитории рассылки первый блок рассылки не успеет выполниться в заданный промежуток времени, то рассылка для этого клиента уже не начнется;\n• Две группы с одинаковыми настройками, определяющих, как рассылка должна проводиться в рабочие и в выходные дни.\nВ каждой группе задаются следующие параметры:\n• «Часы работы» — часы, в которые рассылка будет пытаться начаться для очередной подгруппы клиентов;\n• «Отправлять каждые» — интервал, через который рассылка будет начинаться для следующей группы клиентов;\n• «Максимальное количество клиентов за одну отправку» — размер группы клиентов, для которых рассылка будет начинаться через каждый заданный интервал времени.\nПодробнее о режимах (состояниях) рассылки см. в разделе\nВозможные состояния рассылки\n.\n51 Примечание:\nОдну из групп настроек можно полностью выключить, сняв флажок рядом с названием. В этом случае она применяться не будет.\nНапример, с настройками как на рисунке далее рассылка будет начинаться каждые 10 минут для очередных 100 клиентов из множества всех клиентов аудитории рассылки.\nРисунок 76 — Ввод дополнительных настроек для условия «Начинать в заданное время и отправлять равномерно»\nВажно!\nДни и часы, заданные в настройках равномерной рассылки, могут противоречить дням и часам, заданным в группе\nВремя, когда запланированные действия рассылки не выполняются\n. В этом случае приоритет имеют настройки исключения времени. Т. е. если\n52 один и тот же день задан в настройках равномерной рассылки и в настройках исключения, то рассылка в этот день начинаться не будет.\nКроме того, нужно учитывать, что настройка времени равномерной рассылки применяется в часовом поясе компании, а настройка исключения по времени — в часовом поясе клиента.\nНачинать в заданное время и отправлять равномерно (аудитория из внешней системы)\nПри выборе этого варианта, как и в предыдущем случае, рассылка начинается для клиентов равномерно, одинаковыми «порциями» через заданный период времени. Например, можно начинать рассылку для очередных 100 клиентов через каждые два часа. Отличие от предыдущего случая состоит в источнике клиентов. В данном случае список клиентов, для которых начнется рассылка, загружается динамически из внешнего REST-сервиса при каждой попытке начать рассылку, а не из файла как в предыдущем случае.\nДля примера рассмотрим рассылку с настройками как на рисунке ниже:\nРисунок 77 – Основные настройки равномерной рассылки с аудиторией из внешней системы\nПосле запуска такой рассылки Marketer будет каждые 40 минут запрашивать па адресу «http://example.com/api/v1/customers» список из 200 клиентов в определенном формате (описан ниже). После проверки полученных данных рассылка начнется для этих клиентов. То же самое произойдет еще через 40 минут и так далее в зависимости от других настроек рассылки, которые позволяют ограничить эти запросы по времени. При этом если сервер повторно отдаст клиента, для которого эта рассылка уже началась, то рассылка не начнется для него повторно. Все клиенты, для которых рассылка успешно началась, будут отображаться на вкладке «Целевая аудитория».\nНастройки рассылки в этом случае полностью совпадают с настройками обычной равномерной рассылки для фиксированной аудитории, описанной в предыдущем разделе. Так же задаются часы работы в рабочие и выходные дни, общие ограничения по времени работы и лимиты на количество клиентов. Подробнее это описано в разделе «\nНачинать в заданное время и отправлять равномерно\n».\nФормат данных списка клиентов\nMarketer выполняет GET запрос по указанному в поле «URL для получения аудитории» адресу и добавляет к нему параметр limit, в котором указывает максимальное количество клиентов.\nВнешний REST-сервис должен отдавать список клиентов в формате, описанном в разделе «\nФормат файлов JSON\n» ниже.\nПри этом количество клиентов не должно превышать значение, заданное в параметре limit (но может быть меньше). Это значение устанавливается маркетологом при настройке рассылки в полях «Максимальное количество клиентов за одну отправку» для выходных и рабочих дней отдельно. Если внешний REST-сервис вернет больше клиентов, чем задано в limit, то будет сгенерирована ошибка, рассылка не отправится ни одному клиенту. Через заданное в настройках рассылки время будет выполнен следующий запрос, будут выполняться те же проверки и т.д.\nНапример, в рассылке с настройками как на рисунке выше указан «URL для получения аудитории»\nhttp://example.com/api/v1/customers\nи «Максимальное количество клиентов за одну отправку» 200. Каждые 40 минут Marketer будет выполнять запрос\nGET http://example.com/api/v1/customers?limit=200\nи этот REST-сервис должен возвращать JSON вида\n{\n\"customers\": [\n{\n\"id\": 123456,\n\"timezone\": \"Europe/Moscow\",\n\"failback_to_sms\": true,\n\"customer_data\": {\n\"first_name\": \"Gregory\"\n}\n}\n],\n\"macroses\": [\n{\n\"name\": \"first_name\",\n\"type\": \"string\"\n}\n]\n}\nВ данном случае в списке указан один клиент и рассылка начнется только для него.\n54 Если сервер требует авторизацию, то токен может быть задан в поле «Bearer авторизация»,\nРисунок 78 – параметры авторизации внешнего REST-сервиса\nВ таком случае Marketer будет выполнять запрос с HTTP-заголовком\nAuthorization: Bearer abcdefghijklmnopqrstuvwxyz\nТестирование запросов\nДля проверки работы внешнего REST-сервиса можно воспользоваться кнопкой «Выполнить тестовый вызов». Marketer выполнит GET запрос по указанному URL с параметрами, указанными в настройках, и частично произведет валидацию полученных данных.\nЕсли данные будут получены успешно и будут удовлетворять формату, описанному выше (см.\nФормат данных списка клиентов\n), то результат будет как на рисунке ниже:\nРисунок 79 – Успешное выполнение тестового запроса на загрузку аудитории рассылки\n55 Если Marketer не сможет получить данные по заданному URL, либо их формат не будет соответствовать требуемому, то результат будет иметь такой вид:\nРисунок 80 – Выполнение тестового запроса завершилось ошибкой. Формат данных в ответе внешнего REST-сервиса не соответствует требуемому.\nВажно! Успешное выполнение тестового запроса не гарантирует успешное начало рассылки для клиентов при ее выполнении, т.к. некоторые проверки, например, полноты указанных макросов для каждого клиента, происходят только в ходе выполнения рассылки.\nОтладка рассылок с аудиторией из внешней системы\nЕсли рассылка не начинается для клиентов в указанное время или начинается, но не для всех, можно определить причину такого поведения системы. Для этого необходимо скачать журнал запросов, которые выполнял Marketer к внешнему REST-сервису. Это можно сделать в настройках рассылки на вкладке «Статистика»:\nРисунок 81 – Загрузка журнала запросов аудитории рассылки\nПри скачивании журнала можно применить фильтры по датам, чтобы исключить ненужные данные.\nРезультат представляет собой файл в формате JSON, который описывает все запросы, которые выполнял Marketer для загрузки аудитории, и результаты обработки полученных данных. Формат файла подробно описан ниже.\nЕсли информации о запросах за нужное время нет, это значит, что настройки рассылки запрещают начинать ее в это время, или рассылка была в пассивном или отключенном состоянии.\n56 Формат файла с журналом запросов аудитории рассылки\nПоле Описание\nurl URL, который использовался для выполнения запроса списка клиентов.\nresponse_json Ответ, полученный от сервера. Задано, только если в ответе содержался валидный JSON.\nresponse_text Ответ, полученный от сервера. Задано, только если ответ сервера не является валидным JSON.\nmacroses Список макросов, выделенных из ответа сервера.\nsuccess_customers Список клиентов, для которых рассылка должна успешно начаться.\nduplicate_customers Список клиентов, для которых рассылка уже начиналась и повторно не начнется.\nfailed_customers Список клиентов, данные которых не прошли валидацию. Например, не задан один из макросов или нет необходимых, согласно заданному формату, полей.\nerror Сообщение об ошибке при выполнении запроса.\nfirst_date Дата запроса (или дата первого запроса в серии, если count > 1)\nlast_date Дата запроса (или дата последнего запроса в серии, если count > 1)\ncount Количество запросов в серии одинаковых запросов. Если значение более 1, то это означает, что между first_date и last_date произошло count одинаковых ошибок. Смысл в том, чтобы не засорять журнал множеством одинаковых записей.\nhistory_id Идентификатор записи в журнале.\nНачинать при получении ключевого слова\nВ этом случае рассылка начинается для тех клиентов, которые отправили боту одно из ключевых слов. Ключевое слово должно полностью совпадать с одним из заданных в настройках рассылки текстов (см. Рисунок 82). В одну рассылку можно добавить до 10 ключевых слов.\nПодобные рассылки могут использоваться в различных маркетинговых кампаниях. Например, маркетолог в одной из соцсетей размещает рекламный пост с предложением получить скидку на товары или услуги. Для этого клиент должен написать боту определенное слово или фразу, например, «ХочуСкидку». Если клиент отправляет такое сообщение, для него начинается рассылка – автоворонка продаж.\nРисунок 82 — Настройка рассылки, которая начинается по ключевым словам\nПри проверке совпадения ключевых слов есть ряд важных особенностей:\n• Регистр букв не учитывается. Например, если в настройках рассылки будет указано слово «ХочуСкидку», а клиент пришлет «хочускидку», то рассылка начнется;\n• Пробельные символы до и после слова/фразы не учитываются. Например, если в настройках рассылки будет указано слово «ХочуСкидку», а клиент пришлет «  ХочуСкидку   », то рассылка начнется;\n• Проверяется совпадение всего сообщения целиком. Например, если в настройках рассылки будет указано слово «ХочуСкидку», а клиент пришлет «ХочуСкидку, пожалуйста», то рассылка не начнется;\n• Минимальная длина ключевого слова – один символ. Например, можно использовать смайлик – .\nЕсть ограничение, что для каждого ключевого слова может быть запущена (в активном режиме) только одна рассылка. То есть запуск двух рассылок с одним ключевым словом невозможен. Ограничений на существование рассылок в пассивном и других режимах, настроенных на начало по одному ключевому слову, нет.\nЕще одним условием начала рассылки по ключевым словам, является состояние диалога, в котором клиент отправляет ключевое слово. Если клиент использует ключевое слово в переписке с оператором (состояние диалога active\n) или ботом (состояние диалога bot), то рассылка не начнется. Если ключевое слово будет использовано при ожидании в канале (состояния диалога waiting), то рассылка начнется, но клиент будет уведомлен о том, что ожидание в канале прервано и он вернулся к боту. Ниже представлена Таблица 2, описывающая поведение бота при использовании ключевых слов в разных состояниях диалога.\nПодробнее состояния диалогов описаны в Руководстве оператора в разделе «Приложение Б. Статусы обработки обращений»\nТаблица 2 — Состояние диалога во время начала рассылки по ключевым словам\nСостояние диалога closed bot waiting active\nМожет ли начаться рассылка по ключевым словам? * * - При использовании ключевого слова обращение к оператору будет отклонено. Клиент будет уведомлен об этом и перемещен в канал bot. После этого начнется рассылка по ключевым словам.\nЧтобы рассылка больше не начиналась для клиентов, нужно либо задать дату с временем окончания рассылки, либо вручную остановить рассылку или перевести ее в пассивный режим.\nНачинать при выставлении тега\nВ этом случае рассылка стартует для тех клиентов, которые после ее запуска получили один из заданных\nтегов\n. Если тег уже был выставлен ранее, то рассылка не стартует.\nЕсли после запуска рассылки тег был выставлен дважды, т. е. сначала выставлен, потом удален, а затем снова выставлен, то рассылка может прийти клиенту дважды. Может — потому что есть другая опция, регулирующая это поведение, об этом далее в подразделе\nРасширенные настройки\n.\nЧтобы прекратить запуск рассылок для клиентов, которые получают заданные теги, нужно остановить рассылку или перевести ее в пассивный режим, либо задать дату с временем окончания рассылки.\nНачинать при возникновении события\nВ этом случае сценарий рассылки будет запущен для тех клиентов, для которых после запуска рассылки сгенерировано внешнее событие. Например, CRM компании может сгенерировать событие «Клиент совершил покупку». Информация об этом событии вместе с дополнительными аргументами может быть передана в консоль маркетолога, и для клиента может быть запущена специальная рассылка.\nПодробнее об этом описано в разделе\nИспользование событий\n.\nЧтобы прекратить запуск рассылок для клиентов, для которых генерируются события, нужно остановить рассылку или перевести ее в пассивный режим, либо задать дату с временем окончания рассылки..\nНачинать при возникновении события для заданной аудитории\nВ этом случае рассылка стартует при возникновении события, но не для заданного в событии клиента, а для указанной в настройках рассылки целевой аудитории.",
      "score": 0.556960699558258,
      "node_ids": [
        "chunk_ch0600",
        "chunk_ch0479",
        "chunk_ch0595",
        "chunk_ch0504",
        "chunk_ch0561",
        "chunk_ch0597"
      ]
    },
    {
      "section_id": "section_ch0626",
      "title": "Расширенные настройки",
      "text": "Расширенные настройки\nДля рассылок, начинающихся по событию или тегу, группа расширенных настроек имеет следующий вид (см. Рисунок 86):\nРисунок 86 — Расширенные настройки для рассылок, начинающихся по событию или по тегу\nДля рассылок с фиксированной аудиторией группа расширенных настроек имеет следующий вид (см. Рисунок 87):\nРисунок 87 — Расширенные настройки для рассылок с фиксированной аудиторией\nПримечание:\nПодробнее о типах аудитории см. в разделе\nОпределение аудитории\n.\nОтличаются эти случаи наличием следующих настроек:\n• «Отправлять клиентам, которые уже получали эту рассылку». Если флажок снят, то рассылка для каждого клиента начнется только однажды. Если флажок установлен, то для каждого клиента может быть запущено неограниченное количество одной и той же рассылки.\nДля динамической аудитории данная опция позволяет автоматически предотвратить отправку рассылки одному клиенту более одного раза.\n62 Для рассылок с фиксированной аудиторией эта настройка не имеет смысла, т. к. такая рассылка может запуститься только один раз на каждого клиента.\n• «Исключить клиентов, добавленных в рассылки». При запуске одинаковых рассылок на несколько разных аудиторий возможна следующая проблема: из-за неточного разделения на аудитории некоторые из клиентов могут получить одинаковые рассылки несколько раз.\nПроверка аудитории рассылки вручную может быть довольно сложной и долгой, и при этом все равно не исключает повторных ошибок. Данная настройка позволяет решить проблему повторной отправки одинаковых рассылок одному и тому же клиенту. В поле можно указать несколько рассылок, аудитория каждой из них будет исключаться из аудитории текущей рассылки (см. Рисунок 88).\nРисунок 88 — Исключение клиентов, добавленных в другие рассылки\nЕсли аудитория текущей рассылки будет загружена позже, то исключение клиентов произойдет при загрузке. Если аудитория текущей рассылки уже загружена, то исключение происходит при добавлении каждой новой рассылки в список исключений.\nЕсли рассылка еще не запущена, то клиенты просто удаляются из аудитории текущей рассылки. Если рассылка запущена, то они не удаляются, но помечаются как исключенные, и рассылка для них не начнется. Но если рассылка для них уже началась, то она продолжит выполняться.\nТ. е. эту настройку можно менять у рассылки в любом состоянии, но исключения сработают только для клиентов, для которых рассылка еще не успела начаться (такое вполне вероятно для равномерной рассылки, см. подраздел\nНачинать в заданное время и отправлять равномерно\n).\nНастройка применима только к рассылкам с фиксированной аудиторией и добавлять в исключения можно только рассылки с фиксированной аудиторией.\nВ группу расширенных настроек также входят следующие опции:\n• «Останавливать рассылку для клиентов, получивших один из тегов | у которых удален один из тегов» — при выставлении или снятии с клиента заданного тега его рассылка может быть принудительно остановлена. Это может быть полезно, например, если клиенту запущена рассылка, целью которой является предложение какой-то услуги. Когда клиент приобретает услугу, ему можно выставить соответствующий тег, и рассылка остановится.\n63 При остановке рассылки по тегу отправка запланированных сообщений клиенту не выполняется, кнопки перестают работать. Отменить это действие нельзя.\nПодробнее о тегах см. в разделе\nРабота с тегами\n.\nТег может быть снят двумя способами:\n• При нажатии клиентом кнопки-действия, в настройках которой задано снимать тег;\n• Вызовом API консоли маркетолога, см. подробнее запрос «Изменение тегов клиентов» в разделе\nAPI консоли маркетолога\n.\n• «Отправлять сообщения, даже если клиент отписался от рассылок» — эта опция позволяет отправлять рассылку клиентам даже если они отписались от рассылок. Не следует злоупотреблять этой возможностью в маркетинговых целях. Она предназначена для оповещения клиентов о критически важной информации и работы информационных рассылок.\n• SMS-провайдер — это поле определяет провайдер, который будет использоваться для отправки SMS. Без выбора провайдера добавление SMS-блоков в рассылку будет невозможно (см. также раздел\nНастройка SMS-рассылок\n).\n• Тэги сообщений – это поле определяет специальный тег для отправки рассылок клиентам Facebook*. Без тега клиенту Facebook* не будут приходить рассылки, если за последние 24-часа клиент не общался с ботом или оператором. Для того, чтобы рассылки приходили клиентам всегда, необходимо выставить один из тэгов, который будет соответствовать цели рассылки:\n• CONFIRMED_EVENT_UPDATE - Отправка клиенту напоминаний или обновлений в связи с мероприятиями, на которые он зарегистрировался.\n• POST_PURCHASE_UPDATE - Уведомление клиента об обновлении, связанном с недавней покупкой.\n• ACCOUNT_UPDATE - Уведомление клиента об однократном изменении его заявки или аккаунта.\nС подробным описанием этих тегов можно ознакомиться в\nдокументации Facebook*\n.\nМожно не задавать тег, если рассылка не будет отправляться клиентам Facebook*. Выставленный тег не влияет на клиентов других мессенджеров, кроме Facebook*. Также эти теги не поддерживаются мессенджером Instagram*. Соответственно, отправка рассылок клиентам Instagram* возможна только в рамках 24-часового окна после последнего сообщения от клиента.\nВажно!\nЕсли тег изменен после запуска рассылки, необходимо обновить сценарий рассылки,\nнажав на кнопку , иначе изменения не будут применены.\nИзменения в настройках рассылки, в отличие от изменений в сценарии, применяются сразу (кроме настройки тегов сообщений Facebook*).\n64 При\nотписке клиента от рассылок\nотправка запланированных сообщений клиенту не выполняется, кнопки перестают работать. Клиент не получает новые рассылки. Если клиент\nснова подписывается на рассылки\n, ранее запущенные рассылки продолжают свою работу: кнопки начинают работать, запланированные сообщения начинают приходить (за исключением тех, которые должны были быть отправлены, когда клиент был отписан).",
      "score": 0.556960699558258,
      "node_ids": [
        "chunk_ch0626",
        "chunk_ch0653",
        "chunk_ch0649"
      ]
    },
    {
      "section_id": "section_ch0125",
      "title": "Блоки действий",
      "text": "Блоки действий\nБлок может содержать одно или несколько действий следующих типов:\n1. Отправка сообщения;\n2. Отправка сообщения, содержащего конфиденциальные данные для клиента;\n3. Перевод в канал;\n4. Отмена отправки запланированных сообщений этой рассылки;\n5. Отмена действия кнопок рассылки;\n6. Вызов внешней системы;\n7. Генерация события;\n8. Генерация интента.\nОтправка сообщения\nСообщения могут содержать следующие элементы:\n1. Текст сообщения — текст, который будет отправлен клиенту в мессенджер. Для ввода текста используется поле стандартного блока действий (см. Рисунок 20);\nРисунок 20 — Ввод текстового сообщения для отправки\nПри нажатии на id сообщения (на представленном рисунке это «916») будет открыто окно редактирования, которое удобно использовать для ввода больших текстов рассылок.\n2. Медиа-контент — изображения, видео, аудио и документы, которые могут быть добавлены к сообщению. Поддерживаются наиболее распространенные форматы (см. таблицу 1).\nТаблица 1 — Рекомендуемые форматы файлов и их поддержка в мессенджерах\nТип Форматы Возможность загрузки файлов\nViber ВКонтакте Telegram Facebook* Instagram\n* Изображение JPG JPEG PNG Да Да Да Да Да\nВидео MP4 Да Нет Да Да Да\nАудио MP3 Да Нет Да Да Да\nДокумент PDF DOC(X) XLS(X) TXT Да Да Да Да Да\nВажно!\nСписок рекомендованных форматов, указанный в таблице 1, не является исчерпывающим. У каждого мессенджера есть свой список, который со временем может изменяться. Кроме того, необходимо учитывать, что мессенджеры имеют свои особенности отображения медиа-контента (например, Viber в некоторых случаях не позволяет просматривать изображения в мессенджере).\nОтправка возможна для всех видов контента. При этом, для всех видов контента, кроме изображений, отправляется только ссылка на него. Соответственно, клиент не сможет просматривать аудио, видео или документ прямо в мессенджере (для этого нужно будет воспользоваться браузером или другим приложением.\n19 В таблице приведены наиболее универсальные форматы, подходящие для отправки клиенту в большинство мессенджеров. Перед запуском рассылки для клиентов необходимо предварительно тестировать рассылки на всех мессенджерах.\nДополнительно нужно учитывать, что для некоторых мессенджеров важно, чтобы истинный формат файла соответствовал его расширению (т. е. чтобы изображение image.png действительно имело содержимое, предусмотренное форматом PNG, а не, например, данные в формате JPEG).\nДля добавления медиа-контента необходимо в блоке действий нажать на кнопку и в раскрывшемся меню выбрать пункт «Добавить медиа» (см. Рисунок 21).\nРисунок 21 — Переход к добавлению медиа-контента\nЗатем нужно задать тип медиа-контента и ввести ссылку (URL) на него, либо загрузить\nс компьютера при помощи кнопки (см. Рисунок 22).\nРисунок 22 — Добавление медиа-контента\n3. Медиа группа — изображения и видео, которые могут быть добавлены к сообщению группой.\nВ отличии от предыдущего пункта, медиа группа позволяет отправлять клиенту заранее не определенное количество изображений и видео. Это удобно, например, для информирования клиентов о результате проведенных работ, когда одному\n20 клиенту нужно отправить 10 фотографий, а другому 15. С помощью медиа групп это можно сделать одной рассылкой\n.\nВторое отличие от одиночных медиа состоит в том, что с медиа группа отправляются клиенту одним сообщением\n, тогда как одиночные медиа отправляются каждое в отдельном сообщении.\nВ группах могут отправляться только изображения и видео, документы и аудио отправляться не могут.\nДля добавления группы необходимо в блоке действий нажать на кнопку и в раскрывшемся меню выбрать пункт «Добавить медиа группу» (см. Рисунок 23).\nРисунок 23 — Добавление медиа группы\nВ открывшемся окне можно добавлять и редактировать ссылки на файлы, которые будут отправляться вместе с указанным сообщением (Рисунок 24).\nРисунок 24 — Редактор медиа групп\nДля реализации этого сценария необходимо использовать макросы, см. в\nразделе «Использование макросов»\nВозможности просмотра одиночных и групп медиа («карусель», предпросмотр в виде плиток и т.д.) зависят от мессенджера.\n21 В поле URL можно вставить как сам URL изображения, так и макрос (подробнее о макросах в\nразделе «Использование макросов»\n).\nДля загрузки файлов с устройства используется кнопка . Для клонирования\nэлементов – . Для выбора типа файла необходимо нажать на иконку и в появившемся списке выбрать тип: изображение, видео или макрос.\nЗагруженные элементы отображаются справа. В правой области элементы можно как удалять при наведении мышки и нажатии на кнопку корзины, так и перемещать – кликнув мышкой на элемент и перетянуть в нужное место см. Рисунок 25.\nВ левой области также можно перетаскивать элементы и менять их\nпоследовательность. Для этого необходимо кликнуть мышкой на элемент и перетащить его в нужное место.\nРисунок 25 — Взаимодействие с элементами в правой панели\nВажно!\nМаксимальное количество элементов в медиа группе равно 50. К одному текстовому сообщению может быть присоединена только одна медиа группа.\nВо всех полях медиа группы можно использовать\nмакросы\n.\nРассмотрим случай, когда рассылка с медиа группой будет отправляться клиентам по событию.  Ссылки на изображения мы хотим задавать динамически, в аргументах события, чтобы мы могли отправить одному клиенту 11 фотографий, а другому 20 из одной рассылки. Для этого необходимо:\n1.\nСоздать событие\n, у которого будет 30 аргументов (это будет максимальное число изображений в медиа группе в этом примере) (Рисунок 26);\nРисунок 26 — Создание события для отправки изображений в медиа группе\n2. Создать рассылку и настроить ее на\nначало по этому событию\n;\n3. В конструкторе рассылки в блок добавить медиа группу;\n4. В медиа группу добавить то же самое количество URL, что и в аргументах события (см. Рисунок 27);\nРисунок 27 — Использование макросов с изображениями\n5. В поле URL ввести аргументы события в фигурных скобках, указав в каждом поле только один аргумент, тип файла оставить как изображение (см. Рисунок 27);\n6. Сохранить медиа группу.\n23 После этого необходимо\nсгенерировать событие\nи в аргументах события указать ссылки на файлы для отправки клиенту в мессенджер см. Рисунок 28.\nРисунок 28 — Генерация события с аргументами\nЕсли рассылка должна отправлять не только изображения в медиа группе, но и видео, тогда в макросах нужно передавать еще и тип медиа. Для этого в аргументах события необходимо создать в два раза больше аргументов, чтобы для каждого URL передавался еще и тип, например см. Рисунок 29:\nРисунок 29 — Создания аргументов события для медиа группы\nВ настройках медиа группы для каждого URL выбираем тип \"Макрос\" и задаем URL и его тип макросами, как показано на Рисунок 30.\nРисунок 30 — Создания медиа группы с разными типами\nПосле этого необходимо\nсгенерировать событие\nи в аргументах события указать ссылки на файлы и типы для отправки клиенту в мессенджер, например, см. Рисунок 31.\nРисунок 31 — Генерация события для медиа группы с типами медиа\n4. Кнопки-действия — это кнопки, позволяющие выполнять следующие действия:\n• Вызвать другой блок действий;\n• Добавить клиенту теги;\n• Снять теги с клиента;\n• Отписать клиента от рассылок (всех)\n.\nДля добавления кнопки-действия необходимо в блоке действий нажать на кнопку и в раскрывшемся меню выбрать пункт «Добавить кнопку-действие» (см. Рисунок 32).\nДействие эквивалентно тому, что клиент напишет боту команды «стоп рассылки» или «stop subscriptions», см. раздел\nОтписка от рассылок\n.\nРисунок 32 — Переход к добавлению кнопки-действия\nЗатем нужно задать требуемые параметры кнопки и нажать на кнопку «Сохранить» (см. Рисунок 33). Для каждой кнопки можно указать теги, которые будут назначены клиенту (сняты с клиента), подробнее об этом см. в подразделе\nРабота с тегами\n.\nРисунок 33 — Добавление кнопки-действия\nПримечание:\nДлина заголовка кнопки должна быть не более 20 символов.\nДействия в блоке, связанном с кнопкой, всегда выполняются сразу после нажатия кнопки. (см. Рисунок 34). Блок, вызываемый кнопкой-действием, может содержать любое из действий, описанных в разделе\nБлоки действий\n.\nРисунок 34 — Второй блок выполняется сразу при нажатии на кнопку\nНа одну кнопку клиент может нажать только один раз. Повторные нажатия не обрабатываются. Если сценарий рассылки предусматривает возврат к блоку, который клиент уже получал, то на кнопку можно будет нажать еще раз (см. Рисунок 35). В этом примере при нажатии на кнопку «Назад» клиент получит первый блок еще раз и именно в нем можно будет еще раз нажать на кнопку «Подробнее».\nРисунок 35 — Пример возврата\nПри добавлении к сообщению более двух кнопок-действий появляется опция «Разрешить только одно нажатие» (см. Рисунок 36).\nЕсли она установлена, то клиент может нажать только на одну кнопку в этом сообщении. После первого нажатия аналогичные нажатия по другим кнопкам не обрабатываются. Если опция не установлена, то на каждую кнопку в сообщении можно нажать один раз.\nРисунок 36 — В блок добавлено две кнопки-действия\nВажно!\nОписанное выше относится только к кнопкам сообщения, а не блока. В один блок может быть добавлено несколько сообщений, каждое из которых будет содержать по нескольку кнопок. В этом случае при включенной опции «Разрешить только одно нажатие» в каждом сообщении можно будет нажать по одной кнопке.\nВ некоторых мессенджерах текст сообщений с кнопками может обрезаться. Т.е. клиент увидит не весь отправленный ботом текст, а только первые несколько символов. Предупреждение об этом всплывет справа у окна с текстом см. Рисунок 37. Например, в мобильной версии Viber будет отображаться только первые 40 символов сообщения с кнопкой, а в десктопной версии – первые 10.\nРисунок 37 - Текст с кнопкой, который обрежется в некоторых мессенджерах\nЧтобы обойти эту проблему рекомендуем добавлять отдельное сообщение перед сообщением с кнопкой и задавать в нем основной текст, а в сообщении с кнопкой писать что-то короткое см. Рисунок 38.\nРисунок 38 - Добавлено отдельное сообщение\n5. Кнопки-ссылки — кнопки, позволяющие клиенту перейти по заданной ссылке из мессенджера.\nДля добавления кнопки-ссылки необходимо в блоке действий нажать на кнопку и в раскрывшемся меню выбрать пункт «Добавить кнопку-действие» (см. Рисунок 39).\nРисунок 39 — Переход к добавлению кнопки-ссылки\nЗатем необходимо задать название кнопки и ссылку для нее (см. Рисунок 40).\nРисунок 40 — Создание кнопки-ссылки\n29 Ссылка клиенту не отображается. Нажатия на кнопку-ссылку не могут приводить к запуску другого блока или иным действиям, а также никак не учитываются в статистике.\nПримечание:\nКлиент может нажимать на ссылки многократно, описанные выше ограничения по нажатиям на них не действуют.\nОтправка сообщения, содержащего конфиденциальные данные для клиента\nВ общем случае вся переписка клиента с ботом доступна оператору Maxbot. Если бот используется для отправки конфиденциальной информации (например, кодов подтверждения), то такую информацию необходимо скрывать от оператора.\nДля отправки конфиденциальной информации в теле блока с сообщением необходимо использовать тег <security>…</security> (см Рисунок 41). Вставка закрывающего тега обязательна.\nРисунок 41 — Отправка конфиденциальной информации при помощи тега <security></security>\nДанные, заключенные в теге <security>, для оператора заменяются на ***. То, что увидят клиент и оператор при запуске такой рассылки, показано на рисунке ниже:\nРисунок 42 — Отображение содержимого тега <security> для клиента и для оператора\nНа практике использование тега <security> будет сопровождаться использованием\nмакроса\n, т. е. конфиденциальная информация вряд ли будет задаваться в рассылке статически. В этом случае тег <security> нужно использовать следующим образом (см. Рисунок 43), поместив внутрь макрос, который является аргументом события:\nРисунок 43 — Использование значения макроса в качестве конфиденциальной информации\nПеревод в канал\nДействие перевода в канал выполняется сразу, если диалог у клиента закрыт или диалог свободный\nили иное на задано в настройках действия (см. далее). При наличии открытого диалога перевод выполнен не будет, чтобы не помешать текущему общению клиента с оператором. Перевод будет отложен до тех пор, пока диалог у клиента не будет закрыт или не будут выполнены условия, заданные в настройках действия.\nДля добавления действия перевода в канал нужно нажать на кнопку и в раскрывшемся меню выбрать пункт «Действие», после чего выбрать «Перевести в канал» (см. Рисунок 44):\nРисунок 44 — Выбор действия\nЗатем в открывшемся окне (см. Рисунок 45) необходимо задать параметры для действия перевода в канал.\nВ окне доступны следующие настройки:\n• Выберите канал — канал, в который необходимо перевести клиента;\nСвободный диалог — диалог, у которого канал Bot.\n• Текст при переводе в канал — сообщение, которое будет отправлено клиенту при переводе в канал (если оставить его пустым, то сообщение не будет отправляться);\n• Текст при откладывании перевода в канал — сообщение, которое будет оправлено клиенту, если в момент выполнения действия у него есть открытый диалог и он не свободный (т. е. клиент обсуждает с оператором или ботом какой-то вопрос);\n• Текст перед отложенным переводом в канал — сообщение, которое будет отправлено клиенту при переводе в канал, если он ранее был отложен;\n• Переключатель условия перевода в канал:\n• Перевести сразу (значение по умолчанию) — клиент будет переведен в канал без каких-либо дополнительных условий (кроме наличия открытого/свободного диалога);\n• Перевести после получения сообщения от клиента — клиент будет переведен только после получения от него сообщения и в соответствии с настройками, указанными ниже;\nРисунок 45 — Настройка действия перевода в канал\n• Время ожидания сообщения — время, которое бот ожидает сообщения от клиента для перевода его в канал. Можно установить время не более 2 часов (ограничение введено, чтобы маркетолог не мог надолго «блокировать» клиента: поскольку в момент ожидания не могут выполняться другие рассылки, а также клиенту не смогут отправлять сообщения операторы);\n• Если клиент не ответил за заданное время — действие, которое бот выполнит, не дождавшись сообщения от клиента в течение «времени ожидания сообщения»:\n• «Ничего не делать» — бот не будет предпринимать каких-либо действий; клиент не будет переведен в канал, рассылка при этом продолжится согласно сценарию;\n• «Перевести в канал безусловно» — клиент будет переведен в канал, при этом можно задать другой канал (отличный от исходно заданного);\n• «Отправить сообщение» — клиенту будет отправлено сообщение, заданное в поле ниже; клиент не будет переведен в канал.\nЕсли для рассылки ниже (см. Рисунок 46) задать безусловный перевод клиента в канал по факту нажатия на кнопку «Оставить отзыв», то клиент будет переведен сразу, какого- либо сообщения от него не требуется.\nРисунок 46 — Пример рассылки с переводом в канал\nВ этом случае оператор увидит нового клиента в списке диалогов, но сообщение от клиента будет отсутствовать (см. Рисунок 47).\nРисунок 47 — Клиент переведен в канал без сообщения\n33 Если же в настройках перевода в канал потребовать ввод сообщения от клиента (см. Рисунок 48), то новый диалог появится только после отправки клиентом сообщения.\nРисунок 48 — Ввод условия перевода клиента в канал только при наличии от него сообщения\nВ этом случае оператор уже сразу увидит текст сообщения и не будет тратить время на выяснение причины и содержания обращения (см. Рисунок 49).\nРисунок 49 — Клиент переведен в канал после отправки им сообщения\nОтмена отправки запланированных сообщений\nЭто действие позволяет маркетологу остановить рассылку для клиента при возникновении некоторого события. Например, при нажатии кнопки, при отправке финального сообщения рассылки, при истечении определенного времени.\nДля добавления действия нужно нажать на кнопку и в раскрывшемся меню выбрать пункт «Действие», после чего выбрать «Отключить рассылку запланированных, но еще не отправленных сообщений» (см. Рисунок 50):\nРисунок 50 — Выбор действия\nНа рисунке 51 показан пример такого сценария. Если клиент нажмет на кнопку «Не интересуюсь этим», робот отправит извинительное сообщение и отключит отправку запланированных сообщений. В данном случае это правое нижнее сообщение, которое предполагалось отправить через 5 дней.\nЕсли клиент в течение 5 дней не нажмет эту кнопку, то он получит запланированное сообщение с информацией о продлении акции.\nРисунок 51 — Пример использования события отмены отправки запланированных сообщений\nВажно!\nДействие отмены отправки запланированных сообщений применяется ко всей рассылке для текущего клиента, независимо от того, из какой ветви сценария оно было вызвано.\nОтмена работы уже отправленных в рассылку кнопок\nЭто действие работает аналогично предыдущему, только отменяет не отправку сообщений, а работу кнопок в сообщениях. Вместе с предыдущим действием позволяет полностью деактивировать рассылку для клиентов, у которых они будут выполнены.\nДля добавления действия нужно нажать на кнопку и в раскрывшемся меню выбрать пункт «Действие», после чего выбрать «Отключить работу уже отправленных в рассылку кнопок» (см. Рисунок 52):\nРисунок 52 — Выбор действия\nВ следующем сценарии (см. Рисунок 53) при нажатии на кнопку «Не интересуюсь этим» произойдет не только отмена запланированного сообщения, но и перестанет работать кнопка, отправленная клиенту в первом сообщении.\nРисунок 53 — Использование действия отмены работы уже отправленных в рассылку кнопок\n36 Важно!\nЭто действие отменяет только работу кнопок-действий. Кнопки-ссылки будут всегда доступны, клиенты смогут переходить по ним произвольное число раз.\nДействие отмены работы кнопок применяется ко всей рассылке для текущего клиента, независимо от того, из какой ветви сценария оно было вызвано.\nВызов внешней системы\nДействие «Вызвать внешнюю систему» предназначено для уведомления внешней системы о достижении клиентом того или иного этапа рассылки.\nДля добавления вызова внешней системы нужно нажать на кнопку и в раскрывшемся меню выбрать пункт «Действие», после чего выбрать «Вызвать внешнюю систему» (см. Рисунок 54).\nРисунок 54 — Выбор действия\nДалее необходимо задать параметры запроса к внешней системе. Для примера далее заполнено обращение к CRM компании для того, чтобы отметить интерес клиента к определенной теме в случае нажатия на определенную кнопку (см. Рисунок 55). В дальнейшем в CRM это можно будет использовать для сегментации аудитории.\nПример ниже отражает вариант запроса, при выполнении которого в CRM компании сохраняются данные о том, что клиент с идентификатором 12443 интересуется товарами в категории «наушники» (headphones).\nКроме строковых и числовых параметров также могут использоваться макросы, см. подробнее в разделе\nИспользование макросов\n.\nРисунок 55 — Ввод параметров запроса к внешней системе\nЕсли в блоке есть действие вызова внешней системы, то оно всегда выполняется первым. Если вызов завершается ошибкой (сервер возвращает HTTP-статус, отличный от 200 или не отвечает в течение времени, заданного в поле «Максимальное время выполнения запроса»), то остальные действия блока не выполняются. Если к текущем блоку привязаны последующие блоки (т. е. выполняются после отправки сообщения из этого блока), то они также не будут выполнены.\nПримечание:\nВ текущей версии «Максимальное время выполнения запроса» и все подобные таймауты временно равны 0.5 секунды вне зависимости от заданного значения.\nГенерация события\nБлок этого типа позволяет вызывать события и использовать их для запуска других рассылок из текущей рассылки.\nЕсли клиент по сценарию рассылки перейдет к действию «Сгенерировать событие», то это событие будет сгенерировано либо только для него; если для события задана фиксированная аудитория (см. подробнее в разделе\nОпределение аудитории\n), то событие будет сгенерировано для нее (будет запущена рассылка для множества\n38 клиентов). Это позволит начать одну или несколько других рассылок. Текущая рассылка при этом не будет остановлена, ее сценарий продолжит выполняться.\nРисунок 56 — Выбор действия «Сгенерировать событие\nНапример, есть рассылка, предлагающая клиенту воспользоваться промокодом (см. Рисунок 57). Если клиент нажимает на кнопку, то во втором блоке рассылки генерируется событие «Создание промокода для клиента».\nПримечание:\nСобытие, используемое в сценарии рассылки, должно быть предварительно создано. Подробнее об этом см. в разделе\nИспользование событий\n.\nРисунок 57 — Рассылка, в сценарии которой генерируется событие для клиента\nВ аргументах события, генерируемого для клиента, нужно задать требуемые значения. В нашем случае нужно задать значения для 3-х аргументов (см. Рисунок 58):\n• промокод — строка;\n• размер скидки (%) — число;\n• действует до — строка.\nРисунок 58 — Событие «Создание промокода для клиента» и его аргументы\nПример ввода значений аргументов события показан на рисунке 59.\nПри указании строковых значений необходимо использовать символ кавычек (“); числовые значения и даты задаются без кавычек. Значение аргумента также может быть пустым (не задано).\nПри этом могут быть заданы как статические значения аргументов (в примере выше), так и динамические —\nмакросы\n, уникальные для каждого клиента.\nПереключатель под названием события определяет, для кого будет сгенерировано событие:\n• только для текущего клиента\nили\n• для множества клиентов (для рассылок с фиксированной аудиторией).\nРисунок 59 — Ввод аргументов для события\nТеперь можно создать вторую рассылку, которая будет выполняться при генерации события в первой рассылке. Ниже пример такой рассылки (см. Рисунок 60):\nРисунок 60 — Вторая рассылка, запускаемая по сгенерированному событию и использующая значения аргументов события\nПримечание:\nЕсли рассылка запускается по событию, то его аргументы можно использовать в рассылке как макросы. На рисунке выше во второй рассылке при помощи скобок {{ }} используются значения аргументов сгенерированного события.\nДля данной рассылки нужно выбрать условие «Начинать при возникновении события» и событие «Создание промокода для клиента» (см. Рисунок 61), после чего запустить ее. Рассылка будет «ожидать» выбранного события и выполнится у клиентов, для которых оно наступило.\nРисунок 61 — Определение условий начала второй рассылки\nЕсли в результате выполнения первой рассылки (см. Рисунок 57) клиент нажмет кнопку «Получить промокод», то в результате выполнения второй рассылки будут получены данные промокода (см. Рисунок 62).\nРисунок 62 — После нажатия на кнопку «Получить промокод» для клиента выполнилась вторая рассылка\nГенерация интента\nБлок этого типа позволяет сгенерировать интент (intent) — намерения пользователя, которые могут быть распознаны системой для того, чтобы затем вызвать определенный навык бота.\n42 Для вызова навыков бота необходимо:\n1. Нажать на кнопку и в раскрывшемся меню выбрать пункт «Действие», после чего выбрать «Сгенерировать intent» (см. Рисунок 63).\nРисунок 63 — Выбор действия «Сгенерировать intent»\n2. В настройках действия (см. Рисунок 64) задать название интента и (необязательно) словарь сущностей (entities). Важно, что в поле «Entities» должен быть задан именно словарь в формате JSON (как на рисунке ниже), иначе выполнение сценария рассылки завершится ошибкой.\nВ словаре могут быть использованы как макросы и переменные окружения (в нотации «slots.m.macros_name»), так и статические значения. Этот словарь должен быть валидным jinja-выражением.\nКонстантные выражения также нужно задавать правильно — строки только в кавычках, числа — без, и они не должны оставаться пустыми.\nРисунок 64 — Ввод параметров интента\n43 3. Нажать на кнопку «Сохранить».\nВ результате выполнения этого действия бот сгенерирует указанный интент и передаст slots в качестве параметров. Это позволит запустить нужный навык бота для клиента (например, выбор определенного товара или услуги).\nПримечание:\nЧтобы бот выполнил определенное действие, навыки бота должны быть предварительно настроены.\nВ перспективе это действие должно вытеснить большинство переводов в канал – вместо того, чтобы передавать клиента оператору и занимать его время, рассылка будет вызывать соответствующий навык бота.",
      "score": 0.4361371970176696,
      "node_ids": [
        "chunk_ch0159",
        "chunk_ch0199",
        "chunk_ch0284",
        "chunk_ch0235",
        "chunk_ch0283",
        "chunk_ch0195",
        "chunk_ch0217",
        "chunk_ch0208"
      ]
    },
    {
      "section_id": "section_ch0414",
      "title": "Блок «Форма»",
      "text": "Блок «Форма»\nПри необходимости проведения опроса клиентов можно добавить в рассылку блок «Форма» (см. Рисунок 67). Блок позволяет при помощи конструктора задать порядок проведения опроса, а также форматы вопросов и ответов.\nПодробнее о возможностях данного блока и особенностях его применения в рассылках см. в разделе\nОпрос клиентов с помощью форм\n.\nРисунок 67 — Добавления блока «Форма»",
      "score": 0.3160295462608337,
      "node_ids": [
        "chunk_ch0416"
      ]
    },
    {
      "section_id": "section_ch0420",
      "title": "Связи между блоками действий",
      "text": "Связи между блоками действий\nСвязь между событием и блоком означает безусловное выполнение действий блока сразу или через заданный промежуток времени после возникновения события.\nТаким образом, связь всегда исходит из событий и заканчивается в блоке действий. В один блок действий могут приходить несколько связей.\n45 Список событий, из которых может исходить связь:\n1. Событие Start, т. е. начало выполнения сценария рассылки (см. Рисунок 68);\nРисунок 68 — Связь исходит из события Start\n2. Нажатие на кнопку-действие (см. Рисунок 69);\nРисунок 69 — Связь исходит из кнопки «Узнать подробности»\n3. Отправка сообщения клиенту. От события отправки сообщения также можно строить связь, для этого следует начать связь из точки в правом нижнем углу (см. Рисунок 70). Важно, что это событие происходит только когда сообщение непосредственно ставится в очередь на отправку, а не когда сообщение должно было отправиться.\nНапример, в приведенном ниже рисунке второе сообщение должно отправиться через 5 дней. Если первое сообщение не отправилось сразу после начала рассылки (например, у клиента был открыт диалог и его закрыли только через 1 день), то второе отправится только через 5 дней после отправки первого, т. е. через 6 дней после начала рассылки (а не через 5, как это может показаться из сценария). Поэтому рассылки с подобными связями могут растягиваться на неопределенное время.\nРисунок 70 — Связь исходит из блока с сообщением\nИз события Start может исходить произвольное количество связей. Из остальных событий — только по одному. У всех связей, кроме тех, что исходят из кнопок, можно задать задержку (см. Рисунок 70).\nТакже стоит отметить, что этой точки в правом нижнем углу нет, если в блоке нет действия отправки сообщения (не от чего отталкиваться).",
      "score": 0.3144399499893188,
      "node_ids": [
        "chunk_ch0426"
      ]
    }
  ]
}