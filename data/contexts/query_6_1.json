{
  "query": "условия вопросов в формах",
  "section_candidates": [
    {
      "section_id": "section_ch1393",
      "title": "Использование ответов на вопросы",
      "text": "Использование ответов на вопросы\nЗадача форм – получить от клиентов некоторые данные. К собранным данным можно обращаться аналогично\nмакросам рассылки\n. Там, где используются jinja-шаблоны, нужно указывать:\n{{ form.<идентификатор_ответа_на_вопрос> }}\nНапример, в сообщениях рассылки:\nРисунок 154 — Использование ответа на вопрос в блоке рассылки\nПримечание:\nИдентификатор ответа задается в настройках вопроса, см. подробнее в подразделе\nОсновные настройки вопросов\n.\nТам, где используются jinja-выражения, нужно использовать\nslots.<идентификатор_ответа_на_вопрос>\nНапример (см. Рисунок 155):\nРисунок 155 — Использование ответа на вопрос при вызове внешней системы\nТаким образом, можно передавать все ответы клиента во внешнюю систему при любом\nвыходе из формы, указав их в теле и/или параметрах запроса при вызове внешней системы.\nЕсли совершен выход по таймауту или по желанию клиента, то ответы будут только у тех вопросов, на которые успел до этого ответить клиент. В ответах на остальные вопросы будет None.\nПодобные jinja-шаблоны и jinja-выражения можно использовать во всех остальных действиях рассылки, где предусмотрено использование макросов: при генерации событий из рассылки, при генерации интентов, переводе в канал, отправке сообщений и т. д.\nОсобо стоит описать ответы на вопросы типа «Файл». Ответом в данном случае является список строк – URL файлов, которые клиент прислал боту, а бот загрузил в хранилище файлов. Чтобы передавать его, в некоторых случаях нужно привести этот список к строке. Для этого можно воспользоваться jinja-фильтрами | list|join(', '), а также проверять ответ на пустоту.\nКроме выхода клиента из формы при вводе трех неподходящих ответов.\n119 Например, чтобы передать ответ на вопрос типа «Файл» в параметре запроса вызова внешней системы или как аргумент события, которое генерируется в рассылке, нужно использовать конструкцию вида:\nslots.answer5|list|join(', ') if slots.answer5 else None\nгде answer5 – это идентификатор вопроса типа «Файл».\nНапример (см. Рисунок 156):\nРисунок 156 — Использование ответа на вопрос типа «Файл» при генерации события\nПри использовании jinja-шаблонов применение фильтров и проверка на пустоту для ответов на вопрос типа «Файл» не требуется. Можно просто писать:\n{{ form.answer5 }}",
      "score": 0.8249237632751465,
      "node_ids": [
        "chunk_ch1402",
        "chunk_ch1393",
        "chunk_ch1397",
        "chunk_ch1401",
        "chunk_ch1423",
        "chunk_ch1400",
        "chunk_ch1419",
        "chunk_ch1394",
        "chunk_ch1411",
        "chunk_ch1416",
        "chunk_ch1403",
        "chunk_ch1417",
        "chunk_ch1412",
        "chunk_ch1405",
        "chunk_ch1399",
        "chunk_ch1408",
        "chunk_ch1398",
        "chunk_ch1414",
        "chunk_ch1406",
        "chunk_ch1420",
        "chunk_ch1396",
        "chunk_ch1404"
      ]
    },
    {
      "section_id": "section_ch1344",
      "title": "Настройка условий отправки вопросов",
      "text": "Настройка условий отправки вопросов\nФорма позволяет настраивать условия, при которых вопросы отправляются клиенту. Это полезно, если вопрос уместно задавать только в некоторых случаях. Например, если клиент поставил низкую оценку за качество обслуживания, можно спросить у него, что именно ему не понравилось. Но не нужно задавать этот вопрос, если поставлена максимальная оценка (см. Рисунок 146).\nПри этом есть очевидное ограничение – условный вопрос должен располагаться в списке после вопроса, ответ на который проверяется.\nВажно!\nЕсли вопрос, ответ на который проверяется, был пропущен клиентом, то будут срабатывать все условия «Не равно» при любом значении, с которым происходит сравнение.\nРисунок 146 — Добавление вопроса, который будет задан при выполнении определенного условия",
      "score": 0.8108319735527039,
      "node_ids": [
        "chunk_ch1344",
        "chunk_ch1346",
        "chunk_ch1345",
        "chunk_ch1349",
        "chunk_ch1348"
      ]
    },
    {
      "section_id": "section_ch0681",
      "title": "Определение аудитории",
      "text": "Определение аудитории\nАудитория рассылки может быть фиксированной или динамической. Тип аудитории определяется условиями начала рассылки (см. таблицу 3).\nТаблица 3 — Определение типа аудитории в зависимости от условий начала рассылки\nФиксированная аудитория Динамическая аудитория\n• Начинать сразу после запуска рассылки\n• Начинать в заданное время\n• Начинать в заданное время и отправлять равномерно\n• Начинать при возникновении события для заданной аудитории\n• Начинать в заданное время и отправлять равномерно (аудитория из внешней системы)\n• Начинать при выставлении тега\n• Начинать при возникновении события\n• Начинать при получении ключевого слова\nДинамическая аудитория формируется в ходе рассылки — по мере того, как выставляются теги, генерируются события или клиент отправляет ключевое слово. Как- то ограничить ее нельзя.\nФиксированная аудитория задается до первого запуска рассылки (в состоянии «Не запущена», см. раздел\nВозможные состояния рассылки\n). После запуска рассылки изменить аудиторию полностью или удалить одного из клиентов нельзя. При необходимости запуска на другую аудиторию клиентов рассылку необходимо клонировать, затем задать новую аудиторию, см. подробнее в разделе\nИзменение условий начала и аудитории для запущенной рассылки\n.\nКроме того, для рассылок с фиксированной аудиторией (не по событию) возможен только один запуск рассылки. После того, как рассылка будет запущена и начнется для всех клиентов, она перейдет в пассивный режим. Начать ее заново (перевести в активный режим) нельзя: при попытке выполнить такую операцию бот увидит, что рассылка уже началась для всей аудитории, необработанных клиентов нет, и переведет ее опять в пассивный режим.\n65 Примечание:\nВ зависимости от условий начала рассылки по-разному наступает событие Start. Если аудитория рассылки фиксирована, то событие Start происходит для всех клиентов одновременно в заданное время или сразу после запуска рассылки, или по событию. Если аудитория рассылки не фиксирована, то событие Start происходит при возникновении внешнего события, при выставлении клиенту тега или отправке клиентом ключевого слова боту.\nФиксированная аудитория рассылки задается на вкладке «Целевая аудитория» (см. Рисунок 89). Существует два способа добавления фиксированной аудитории в рассылку: с помощью файлов в формате JSON и CSV.\nРисунок 89 — Вкладка «Целевая аудитория»",  
      "score": 0.5453112673759459,
      "node_ids": [
        "chunk_ch0683",
        "chunk_ch0700",
        "chunk_ch0698",
        "chunk_ch0695",
        "chunk_ch0684",
        "chunk_ch0681",
        "chunk_ch0697",
        "chunk_ch0682"
      ]
    },
    {
      "section_id": "section_ch0450",
      "title": "Настройка условий начала рассылки",
      "text": "Настройка условий начала рассылки\nНастройки, задаваемые на вкладке «Условия начала рассылки», определяют правила запуска для клиентов из аудитории рассылки. Эти настройки можно разделить на четыре части (см. Рисунок 75):\n• Условия начала рассылки для клиентов (1);\n• Время, после которого рассылка не начнется для клиента (2);\n• Время, когда никакие действия рассылки не выполняются для клиента (3);\n• Расширенные настройки (4).\nРисунок 75 — Настройки условий начала рассылки\nВажно отметить, что условия начала задаются до первого запуска рассылки в состоянии «Не запущена» (см. подробнее в разделе\nВозможные состояния рассылки\n). После запуска рассылки изменить условия начала нельзя. Это касается следующих изменений:\n• изменение условия начала рассылки (т. е., например, перехода от тега к событию),\n• изменение тега или события, которые начинают рассылку,\n• изменение времени, в которое начнется рассылка (для рассылок с фиксированной аудиторией, которые начинаются в заданное время);\n• изменение времени, после которого рассылка не начнется для клиента.\nЕсли нужно изменить эти параметры, следует клонировать рассылку и внести изменения до запуска рассылки, см. подробнее в разделе\nИзменение условий начала и аудитории для запущенной рассылки\n.",
      "score": 0.4950383257865905,
      "node_ids": [
        "chunk_ch0467",
        "chunk_ch0450",
        "chunk_ch0459",
        "chunk_ch0451",
        "chunk_ch0452",
        "chunk_ch0458",
        "chunk_ch0466"
      ]
    },
    {
      "section_id": "section_ch0468",
      "title": "Условия начала",
      "text": "Условия начала\nНачать сразу после запуска рассылки\nПри выборе этой настройки рассылка начинает выполняться для всех клиентов из аудитории рассылки сразу после ее запуска. Аудитория рассылки фиксирована (задается до запуска рассылки) и не может быть изменена до остановки рассылки.\nПосле того, как рассылка начнется для всех клиентов она автоматически переходит в пассивный режим. В этом состоянии продолжается выполнение сценария рассылки для клиентов.\nНачинать в заданное время\nПри выборе этой настройки рассылка стартует для всех клиентов из аудитории рассылки в заданное маркетологом время.\nПрочие условия аналогичны предыдущей опции.\nНачинать в заданное время и отправлять равномерно\nЭта настройка позволяет автоматически разделить аудиторию и отправлять рассылки одинаковыми «порциями». Это может быть полезно, например, чтобы сделать нагрузку на операторов, принимающих заявки от клиентов из рассылки, более-менее равномерной. Как и в двух предыдущих случаях аудитория рассылки фиксирована и задается до ее запуска.\nСхема работы рассылки при выборе данной опции следующая: все клиенты аудитории разделяются на подгруппы заданного размера, например, по 500 человек. Рассылка начинается не для всех клиентов из аудитории сразу, как для предыдущих двух вариантов, а только для клиентов одной подгруппы. Далее бот ждет заданное время, и начинает рассылку для следующей подгруппы клиентов. При этом рассылка начинается для подгрупп клиентов только в заданное время, например, «вторник-четверг с 11 до 16». В остальное время рассылка не начинается.\nПри выборе этой настройки отображаются дополнительные опции (см. Рисунок 76):\n• Даты начала и окончания — определяют время, когда рассылка начнется\nдля первой «порции» клиентов и когда она перестанет начинаться. Иными словами, если для какого-то клиента из аудитории рассылки первый блок рассылки не успеет выполниться в заданный промежуток времени, то рассылка для этого клиента уже не начнется;\n• Две группы с одинаковыми настройками, определяющих, как рассылка должна проводиться в рабочие и в выходные дни.\nВ каждой группе задаются следующие параметры:\n• «Часы работы» — часы, в которые рассылка будет пытаться начаться для очередной подгруппы клиентов;\n• «Отправлять каждые» — интервал, через который рассылка будет начинаться для следующей группы клиентов;\n• «Максимальное количество клиентов за одну отправку» — размер группы клиентов, для которых рассылка будет начинаться через каждый заданный интервал времени.\nПодробнее о режимах (состояниях) рассылки см. в разделе\nВозможные состояния рассылки\n.\n51 Примечание:\nОдну из групп настроек можно полностью выключить, сняв флажок рядом с названием. В этом случае она применяться не будет.\nНапример, с настройками как на рисунке далее рассылка будет начинаться каждые 10 минут для очередных 100 клиентов из множества всех клиентов аудитории рассылки.\nРисунок 76 — Ввод дополнительных настроек для условия «Начинать в заданное время и отправлять равномерно»\nВажно!\nДни и часы, заданные в настройках равномерной рассылки, могут противоречить дням и часам, заданным в группе\nВремя, когда запланированные действия рассылки не выполняются\n. В этом случае приоритет имеют настройки исключения времени. Т. е. если\n52 один и тот же день задан в настройках равномерной рассылки и в настройках исключения, то рассылка в этот день начинаться не будет.\nКроме того, нужно учитывать, что настройка времени равномерной рассылки применяется в часовом поясе компании, а настройка исключения по времени — в часовом поясе клиента.\nНачинать в заданное время и отправлять равномерно (аудитория из внешней системы)\nПри выборе этого варианта, как и в предыдущем случае, рассылка начинается для клиентов равномерно, одинаковыми «порциями» через заданный период времени. Например, можно начинать рассылку для очередных 100 клиентов через каждые два часа. Отличие от предыдущего случая состоит в источнике клиентов. В данном случае список клиентов, для которых начнется рассылка, загружается динамически из внешнего REST-сервиса при каждой попытке начать рассылку, а не из файла как в предыдущем случае.\nДля примера рассмотрим рассылку с настройками как на рисунке ниже:\nРисунок 77 – Основные настройки равномерной рассылки с аудиторией из внешней системы\nПосле запуска такой рассылки Marketer будет каждые 40 минут запрашивать па адресу «http://example.com/api/v1/customers» список из 200 клиентов в определенном формате (описан ниже). После проверки полученных данных рассылка начнется для этих клиентов. То же самое произойдет еще через 40 минут и так далее в зависимости от других настроек рассылки, которые позволяют ограничить эти запросы по времени. При этом если сервер повторно отдаст клиента, для которого эта рассылка уже началась, то рассылка не начнется для него повторно. Все клиенты, для которых рассылка успешно началась, будут отображаться на вкладке «Целевая аудитория».\nНастройки рассылки в этом случае полностью совпадают с настройками обычной равномерной рассылки для фиксированной аудитории, описанной в предыдущем разделе. Так же задаются часы работы в рабочие и выходные дни, общие ограничения по времени работы и лимиты на количество клиентов. Подробнее это описано в разделе «\nНачинать в заданное время и отправлять равномерно\n».\nФормат данных списка клиентов\nMarketer выполняет GET запрос по указанному в поле «URL для получения аудитории» адресу и добавляет к нему параметр limit, в котором указывает максимальное количество клиентов.\nВнешний REST-сервис должен отдавать список клиентов в формате, описанном в разделе «\nФормат файлов JSON\n» ниже.\nПри этом количество клиентов не должно превышать значение, заданное в параметре limit (но может быть меньше). Это значение устанавливается маркетологом при настройке рассылки в полях «Максимальное количество клиентов за одну отправку» для выходных и рабочих дней отдельно. Если внешний REST-сервис вернет больше клиентов, чем задано в limit, то будет сгенерирована ошибка, рассылка не отправится ни одному клиенту. Через заданное в настройках рассылки время будет выполнен следующий запрос, будут выполняться те же проверки и т.д.\nНапример, в рассылке с настройками как на рисунке выше указан «URL для получения аудитории»\nhttp://example.com/api/v1/customers\nи «Максимальное количество клиентов за одну отправку» 200. Каждые 40 минут Marketer будет выполнять запрос\nGET http://example.com/api/v1/customers?limit=200\nи этот REST-сервис должен возвращать JSON вида\n{\n\"customers\": [\n{\n\"id\": 123456,\n\"timezone\": \"Europe/Moscow\",\n\"failback_to_sms\": true,\n\"customer_data\": {\n\"first_name\": \"Gregory\"\n}\n}\n],\n\"macroses\": [\n{\n\"name\": \"first_name\",\n\"type\": \"string\"\n}\n]\n}\nВ данном случае в списке указан один клиент и рассылка начнется только для него.\n54 Если сервер требует авторизацию, то токен может быть задан в поле «Bearer авторизация»,\nРисунок 78 – параметры авторизации внешнего REST-сервиса\nВ таком случае Marketer будет выполнять запрос с HTTP-заголовком\nAuthorization: Bearer abcdefghijklmnopqrstuvwxyz\nТестирование запросов\nДля проверки работы внешнего REST-сервиса можно воспользоваться кнопкой «Выполнить тестовый вызов». Marketer выполнит GET запрос по указанному URL с параметрами, указанными в настройках, и частично произведет валидацию полученных данных.\nЕсли данные будут получены успешно и будут удовлетворять формату, описанному выше (см.\nФормат данных списка клиентов\n), то результат будет как на рисунке ниже:\nРисунок 79 – Успешное выполнение тестового запроса на загрузку аудитории рассылки\n55 Если Marketer не сможет получить данные по заданному URL, либо их формат не будет соответствовать требуемому, то результат будет иметь такой вид:\nРисунок 80 – Выполнение тестового запроса завершилось ошибкой. Формат данных в ответе внешнего REST-сервиса не соответствует требуемому.\nВажно! Успешное выполнение тестового запроса не гарантирует успешное начало рассылки для клиентов при ее выполнении, т.к. некоторые проверки, например, полноты указанных макросов для каждого клиента, происходят только в ходе выполнения рассылки.\nОтладка рассылок с аудиторией из внешней системы\nЕсли рассылка не начинается для клиентов в указанное время или начинается, но не для всех, можно определить причину такого поведения системы. Для этого необходимо скачать журнал запросов, которые выполнял Marketer к внешнему REST-сервису. Это можно сделать в настройках рассылки на вкладке «Статистика»:\nРисунок 81 – Загрузка журнала запросов аудитории рассылки\nПри скачивании журнала можно применить фильтры по датам, чтобы исключить ненужные данные.\nРезультат представляет собой файл в формате JSON, который описывает все запросы, которые выполнял Marketer для загрузки аудитории, и результаты обработки полученных данных. Формат файла подробно описан ниже.\nЕсли информации о запросах за нужное время нет, это значит, что настройки рассылки запрещают начинать ее в это время, или рассылка была в пассивном или отключенном состоянии.\n56 Формат файла с журналом запросов аудитории рассылки\nПоле Описание\nurl URL, который использовался для выполнения запроса списка клиентов.\nresponse_json Ответ, полученный от сервера. Задано, только если в ответе содержался валидный JSON.\nresponse_text Ответ, полученный от сервера. Задано, только если ответ сервера не является валидным JSON.\nmacroses Список макросов, выделенных из ответа сервера.\nsuccess_customers Список клиентов, для которых рассылка должна успешно начаться.\nduplicate_customers Список клиентов, для которых рассылка уже начиналась и повторно не начнется.\nfailed_customers Список клиентов, данные которых не прошли валидацию. Например, не задан один из макросов или нет необходимых, согласно заданному формату, полей.\nerror Сообщение об ошибке при выполнении запроса.\nfirst_date Дата запроса (или дата первого запроса в серии, если count > 1)\nlast_date Дата запроса (или дата последнего запроса в серии, если count > 1)\ncount Количество запросов в серии одинаковых запросов. Если значение более 1, то это означает, что между first_date и last_date произошло count одинаковых ошибок. Смысл в том, чтобы не засорять журнал множеством одинаковых записей.\nhistory_id Идентификатор записи в журнале.\nНачинать при получении ключевого слова\nВ этом случае рассылка начинается для тех клиентов, которые отправили боту одно из ключевых слов. Ключевое слово должно полностью совпадать с одним из заданных в настройках рассылки текстов (см. Рисунок 82). В одну рассылку можно добавить до 10 ключевых слов.\nПодобные рассылки могут использоваться в различных маркетинговых кампаниях. Например, маркетолог в одной из соцсетей размещает рекламный пост с предложением получить скидку на товары или услуги. Для этого клиент должен написать боту определенное слово или фразу, например, «ХочуСкидку». Если клиент отправляет такое сообщение, для него начинается рассылка – автоворонка продаж.\nРисунок 82 — Настройка рассылки, которая начинается по ключевым словам\nПри проверке совпадения ключевых слов есть ряд важных особенностей:\n• Регистр букв не учитывается. Например, если в настройках рассылки будет указано слово «ХочуСкидку», а клиент пришлет «хочускидку», то рассылка начнется;\n• Пробельные символы до и после слова/фразы не учитываются. Например, если в настройках рассылки будет указано слово «ХочуСкидку», а клиент пришлет «  ХочуСкидку   », то рассылка начнется;\n• Проверяется совпадение всего сообщения целиком. Например, если в настройках рассылки будет указано слово «ХочуСкидку», а клиент пришлет «ХочуСкидку, пожалуйста», то рассылка не начнется;\n• Минимальная длина ключевого слова – один символ. Например, можно использовать смайлик – .\nЕсть ограничение, что для каждого ключевого слова может быть запущена (в активном режиме) только одна рассылка. То есть запуск двух рассылок с одним ключевым словом невозможен. Ограничений на существование рассылок в пассивном и других режимах, настроенных на начало по одному ключевому слову, нет.\nЕще одним условием начала рассылки по ключевым словам, является состояние диалога, в котором клиент отправляет ключевое слово. Если клиент использует ключевое слово в переписке с оператором (состояние диалога active\n) или ботом (состояние диалога bot), то рассылка не начнется. Если ключевое слово будет использовано при ожидании в канале (состояния диалога waiting), то рассылка начнется, но клиент будет уведомлен о том, что ожидание в канале прервано и он вернулся к боту. Ниже представлена Таблица 2, описывающая поведение бота при использовании ключевых слов в разных состояниях диалога.\nПодробнее состояния диалогов описаны в Руководстве оператора в разделе «Приложение Б. Статусы обработки обращений»\nТаблица 2 — Состояние диалога во время начала рассылки по ключевым словам\nСостояние диалога closed bot waiting active\nМожет ли начаться рассылка по ключевым словам? * * - При использовании ключевого слова обращение к оператору будет отклонено. Клиент будет уведомлен об этом и перемещен в канал bot. После этого начнется рассылка по ключевым словам.\nЧтобы рассылка больше не начиналась для клиентов, нужно либо задать дату с временем окончания рассылки, либо вручную остановить рассылку или перевести ее в пассивный режим.\nНачинать при выставлении тега\nВ этом случае рассылка стартует для тех клиентов, которые после ее запуска получили один из заданных\nтегов\n. Если тег уже был выставлен ранее, то рассылка не стартует.\nЕсли после запуска рассылки тег был выставлен дважды, т. е. сначала выставлен, потом удален, а затем снова выставлен, то рассылка может прийти клиенту дважды. Может — потому что есть другая опция, регулирующая это поведение, об этом далее в подразделе\nРасширенные настройки\n.\nЧтобы прекратить запуск рассылок для клиентов, которые получают заданные теги, нужно остановить рассылку или перевести ее в пассивный режим, либо задать дату с временем окончания рассылки.\nНачинать при возникновении события\nВ этом случае сценарий рассылки будет запущен для тех клиентов, для которых после запуска рассылки сгенерировано внешнее событие. Например, CRM компании может сгенерировать событие «Клиент совершил покупку». Информация об этом событии вместе с дополнительными аргументами может быть передана в консоль маркетолога, и для клиента может быть запущена специальная рассылка.\nПодробнее об этом описано в разделе\nИспользование событий\n.\nЧтобы прекратить запуск рассылок для клиентов, для которых генерируются события, нужно остановить рассылку или перевести ее в пассивный режим, либо задать дату с временем окончания рассылки..\nНачинать при возникновении события для заданной аудитории\nВ этом случае рассылка стартует при возникновении события, но не для заданного в событии клиента, а для указанной в настройках рассылки целевой аудитории.",
      "score": 0.4495862698554992,
      "node_ids": [
        "chunk_ch0545",
        "chunk_ch0484",
        "chunk_ch0524",
        "chunk_ch0534",
        "chunk_ch0522",
        "chunk_ch0539"
      ]
    },
    {
      "section_id": "section_ch0704",
      "title": "Формат файлов JSON",
      "text": "Формат файлов JSON\nФормат JSON-файла с целевой аудиторией рассылки:\n{\n\"customers\": [\n{\n\"id\": <идентификатор клиента в Maxbot>,\n\"phone\": <телефон>,\n\"messengers_order\": <порядок следования мессенджеров>,\n\"timezone\": <часовой пояс клиента>,\n\"failback_to_sms\": <признак отправки SMS>,\n\"customer_data\": {\n\"<название макроса>\": \"<значение макроса>\"\n}\n}\n],\n\"macroses\": [\n{\n\"name\": <название макроса>,\n\"type\": <тип макроса>\n}\n]\n}\nТаблица 4 — Описание полей JSON-файла описания аудитории рассылки\nПоле Описание Пример использования\ncustomers[] Массив клиентов, описание полей каждого клиента приведено ниже. —\ncustomers[].id Внутренний идентификатор клиента в Maxbot. Получить его можно, скачав в разделе\nВыгрузка аудитории\nфайл с клиентами для выбранного бота. 12345\ncustomers[].phone Телефон клиента в формате \"7xxxxxxxxxx\" без + и 8. \"79999999999\"\ncustomers[].messengers_order Список мессенджеров по приоритету. Возможные значения: telegram, viber, vkontakte, facebook*, Instagram*. [\"telegram\", \"vkontakte\", \"facebook*\"]\ncustomers[].timezone Часовой пояс клиента (см.\nПриложение А\n). \"Europe/Moscow\" \"Etc/GMT+3\" \"Japan\" \"UTC\"\ncustomers[].failback_to_sms Логический признак: отправлять ли SMS клиенту, если он еще не подтвердил номер телефона ни в одном из мессенджеров. Для применения этого признака должен быть задан телефон (phone). Необязательное поле, по умолчанию false. Если failback_to_sms = true и клиент не подтвердил номер телефона, то ему будут отправлены заданные в рассылке SMS. Если failback_to_sms = false, и клиент не подтвердил номер телефона, то клиент не будет добавлен в аудиторию рассылки. Если клиент уже подтвердил указанный номер телефона, то по номеру будет определен id, которому и будет отправлена рассылка в соответствии с заданным приоритетом мессенджеров. Для принудительной отправки SMS клиенту можно задать поле false или true\n67 Поле Описание Пример использования messengers_order пустым и выставить failback_to_sms = True. Тогда клиент получит SMS даже если уже подтвердил номер телефона в мессенджерах.\ncustomers[].customer_data Значения макросов клиента (см. подробнее о макросах в разделе\nИспользование макросов\n), задаются в виде пар значений «имя макроса» : «значение макроса». \"name\": \"Mark\"\nmacroses[] Массив описаний макросов. —\nmacroses[].name Название макроса. \"name\"\nmacroses[].type Тип макроса (см.\nПриложение Б\n). \"string\"\nДля каждого клиента должен быть задан:\n• id\nлибо\n• phone и messengers_order\nлибо\n• только phone (если нужно принудительно отправить SMS).\nЕсли заданы все три поля, то приоритет имеет id.\nПример JSON-файла:\n{\n\"customers\": [\n{\n\"id\": 125241,\n\"timezone\": \"Europe/Moscow\",\n\"customer_data\": {\n\"name\": \"John\"\n}\n},\n{\n\"phone\": \"79999999999\",\n\"messengers_order\": [\"telegram\", \"vkontakte\", \"facebook*\"],\n\"timezone\": \"Europe/Moscow\",\n\"failback_to_sms\": true,\n\"customer_data\": {\n\"name\": \"Mark\"\n}\n}\n],\n\"macroses\": [\n{\n\"name\": \"name\",\n\"type\": \"string\"\n}\n]\n}\nВ указанном примере заданы два получателя рассылки. Первый задается по идентификатору в Maxbot (id), второй — по номеру телефона и приоритету мессенджеров (phone + messengers_order).",
      "score": 0.4399470663070678,
      "node_ids": [
        "chunk_ch0764",
        "chunk_ch0765",
        "chunk_ch0777",
        "chunk_ch0706",
        "chunk_ch0758",
        "chunk_ch0720",
        "chunk_ch0708",
        "chunk_ch0756",
        "chunk_ch0763",
        "chunk_ch0723",
        "chunk_ch0772"
      ]
    },
    {
      "section_id": "section_ch0626",
      "title": "Расширенные настройки",
      "text": "Расширенные настройки\nДля рассылок, начинающихся по событию или тегу, группа расширенных настроек имеет следующий вид (см. Рисунок 86):\nРисунок 86 — Расширенные настройки для рассылок, начинающихся по событию или по тегу\nДля рассылок с фиксированной аудиторией группа расширенных настроек имеет следующий вид (см. Рисунок 87):\nРисунок 87 — Расширенные настройки для рассылок с фиксированной аудиторией\nПримечание:\nПодробнее о типах аудитории см. в разделе\nОпределение аудитории\n.\nОтличаются эти случаи наличием следующих настроек:\n• «Отправлять клиентам, которые уже получали эту рассылку». Если флажок снят, то рассылка для каждого клиента начнется только однажды. Если флажок установлен, то для каждого клиента может быть запущено неограниченное количество одной и той же рассылки.\nДля динамической аудитории данная опция позволяет автоматически предотвратить отправку рассылки одному клиенту более одного раза.\n62 Для рассылок с фиксированной аудиторией эта настройка не имеет смысла, т. к. такая рассылка может запуститься только один раз на каждого клиента.\n• «Исключить клиентов, добавленных в рассылки». При запуске одинаковых рассылок на несколько разных аудиторий возможна следующая проблема: из-за неточного разделения на аудитории некоторые из клиентов могут получить одинаковые рассылки несколько раз.\nПроверка аудитории рассылки вручную может быть довольно сложной и долгой, и при этом все равно не исключает повторных ошибок. Данная настройка позволяет решить проблему повторной отправки одинаковых рассылок одному и тому же клиенту. В поле можно указать несколько рассылок, аудитория каждой из них будет исключаться из аудитории текущей рассылки (см. Рисунок 88).\nРисунок 88 — Исключение клиентов, добавленных в другие рассылки\nЕсли аудитория текущей рассылки будет загружена позже, то исключение клиентов произойдет при загрузке. Если аудитория текущей рассылки уже загружена, то исключение происходит при добавлении каждой новой рассылки в список исключений.\nЕсли рассылка еще не запущена, то клиенты просто удаляются из аудитории текущей рассылки. Если рассылка запущена, то они не удаляются, но помечаются как исключенные, и рассылка для них не начнется. Но если рассылка для них уже началась, то она продолжит выполняться.\nТ. е. эту настройку можно менять у рассылки в любом состоянии, но исключения сработают только для клиентов, для которых рассылка еще не успела начаться (такое вполне вероятно для равномерной рассылки, см. подраздел\nНачинать в заданное время и отправлять равномерно\n).\nНастройка применима только к рассылкам с фиксированной аудиторией и добавлять в исключения можно только рассылки с фиксированной аудиторией.\nВ группу расширенных настроек также входят следующие опции:\n• «Останавливать рассылку для клиентов, получивших один из тегов | у которых удален один из тегов» — при выставлении или снятии с клиента заданного тега его рассылка может быть принудительно остановлена. Это может быть полезно, например, если клиенту запущена рассылка, целью которой является предложение какой-то услуги. Когда клиент приобретает услугу, ему можно выставить соответствующий тег, и рассылка остановится.\n63 При остановке рассылки по тегу отправка запланированных сообщений клиенту не выполняется, кнопки перестают работать. Отменить это действие нельзя.\nПодробнее о тегах см. в разделе\nРабота с тегами\n.\nТег может быть снят двумя способами:\n• При нажатии клиентом кнопки-действия, в настройках которой задано снимать тег;\n• Вызовом API консоли маркетолога, см. подробнее запрос «Изменение тегов клиентов» в разделе\nAPI консоли маркетолога\n.\n• «Отправлять сообщения, даже если клиент отписался от рассылок» — эта опция позволяет отправлять рассылку клиентам даже если они отписались от рассылок. Не следует злоупотреблять этой возможностью в маркетинговых целях. Она предназначена для оповещения клиентов о критически важной информации и работы информационных рассылок.\n• SMS-провайдер — это поле определяет провайдер, который будет использоваться для отправки SMS. Без выбора провайдера добавление SMS-блоков в рассылку будет невозможно (см. также раздел\nНастройка SMS-рассылок\n).\n• Тэги сообщений – это поле определяет специальный тег для отправки рассылок клиентам Facebook*. Без тега клиенту Facebook* не будут приходить рассылки, если за последние 24-часа клиент не общался с ботом или оператором. Для того, чтобы рассылки приходили клиентам всегда, необходимо выставить один из тэгов, который будет соответствовать цели рассылки:\n• CONFIRMED_EVENT_UPDATE - Отправка клиенту напоминаний или обновлений в связи с мероприятиями, на которые он зарегистрировался.\n• POST_PURCHASE_UPDATE - Уведомление клиента об обновлении, связанном с недавней покупкой.\n• ACCOUNT_UPDATE - Уведомление клиента об однократном изменении его заявки или аккаунта.\nС подробным описанием этих тегов можно ознакомиться в\nдокументации Facebook*\n.\nМожно не задавать тег, если рассылка не будет отправляться клиентам Facebook*. Выставленный тег не влияет на клиентов других мессенджеров, кроме Facebook*. Также эти теги не поддерживаются мессенджером Instagram*. Соответственно, отправка рассылок клиентам Instagram* возможна только в рамках 24-часового окна после последнего сообщения от клиента.\nВажно!\nЕсли тег изменен после запуска рассылки, необходимо обновить сценарий рассылки,\nнажав на кнопку , иначе изменения не будут применены.\nИзменения в настройках рассылки, в отличие от изменений в сценарии, применяются сразу (кроме настройки тегов сообщений Facebook*).\n64 При\nотписке клиента от рассылок\nотправка запланированных сообщений клиенту не выполняется, кнопки перестают работать. Клиент не получает новые рассылки. Если клиент\nснова подписывается на рассылки\n, ранее запущенные рассылки продолжают свою работу: кнопки начинают работать, запланированные сообщения начинают приходить (за исключением тех, которые должны были быть отправлены, когда клиент был отписан).",
      "score": 0.4225535368919372,
      "node_ids": [
        "chunk_ch0655"
      ]
    }
  ]
}