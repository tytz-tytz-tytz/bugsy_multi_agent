{
  "query": "макросы в конструкторе рассылок",
  "section_candidates": [
    {
      "section_id": "section_ch1147",
      "title": "Использование макросов",
      "text": "Использование макросов\nМакросы позволяют персонифицировать рассылки для клиентов. Например, можно создать рассылку (см. Рисунок 134), в тексте которой используются два макроса:\n• customer_name — имя и отчество клиента;\n• customer_discount — персональная скидка.\nРисунок 134 — Рассылка, использующая два макроса\nДалее можно использовать файл аудитории, в котором заданы значения для используемых макросов. Например, файл в формате JSON может иметь следующий вид:\n{\n\"customers\": [\n{\n\"id\": 13561,\n\"timezone\": \"Europe/Moscow\",\n\"customer_data\": {\n\"customer_name\": \"Дмитрий Владимирович\",\n\"customer_discount\": \"15\"\n}\n},\n{\n\"phone\": \"79999999999\",\n\"messengers_order\": [\"telegram\", \"vkontakte\", \"facebook*\"],\n\"timezone\": \"Europe/Moscow\",\n\"failback_to_sms\": false,\n\"customer_data\": {\n\"customer_name\": \"Владимир Валерьевич\",\n\"customer_discount\": \"10\"\n}\n}\n],\n\"macroses\": [\n{\n\"name\": \"customer_name\",\n\"type\": \"string\"\n},\n{\n\"name\": \"customer_discount\",\n\"type\": \"string\"\n}\n]\n}\nКаждому клиенту из аудитории рассылки можно задать свои значения, таким образом, сделав рассылку уникальной для каждого клиента.\nПосле запуска клиенты получат рассылку, в которой бот обратится к ним по именам, а также укажет для каждого из них размер персональной скидки (для первого клиента 15%, для второго — 10%).",
      "score": 0.8273674201965331,
      "node_ids": [
        "chunk_ch1147",
        "chunk_ch1148",
        "chunk_ch1175",
        "chunk_ch1151",
        "chunk_ch1179",
        "chunk_ch1162",
        "chunk_ch1176",
        "chunk_ch1155",
        "chunk_ch1163",
        "chunk_ch1180",
        "chunk_ch1153",
        "chunk_ch1172",
        "chunk_ch1173",
        "chunk_ch1183",
        "chunk_ch1185",
        "chunk_ch1161",
        "chunk_ch1152",
        "chunk_ch1184",
        "chunk_ch1174"
      ]
    },
    {
      "section_id": "section_ch2133",
      "title": "Приложение Б. Типы макросов",
      "text": "Приложение Б. Типы макросов\nМакросы могут иметь следующие типы:\n• “date” — дата и время (используется формат ISO 8601);\n• “decimal“ — число, в т. ч. вещественное;\n• “categorical“ — фиксированное число возможных значений;\n• “boolean“ — логическое значение;\n• “string“ — строка.\nДля отправки клиентам в макросах рассылки персонализированных многострочных текстов можно использовать символ разделения строк — \\n (в макросах типа «string»). Эта возможность доступна только для API-вызовов, при вызове события из интерфейса (тестовый вызов события из консоли маркетолога) клиент получит \\n в тексте рассылки.",
      "score": 0.8111545395851134,
      "node_ids": [
        "chunk_ch2133",
        "chunk_ch2140",
        "chunk_ch2134"
      ]
    },
    {
      "section_id": "section_ch0125",
      "title": "Блоки действий",
      "text": "Блоки действий\nБлок может содержать одно или несколько действий следующих типов:\n1. Отправка сообщения;\n2. Отправка сообщения, содержащего конфиденциальные данные для клиента;\n3. Перевод в канал;\n4. Отмена отправки запланированных сообщений этой рассылки;\n5. Отмена действия кнопок рассылки;\n6. Вызов внешней системы;\n7. Генерация события;\n8. Генерация интента.\nОтправка сообщения\nСообщения могут содержать следующие элементы:\n1. Текст сообщения — текст, который будет отправлен клиенту в мессенджер. Для ввода текста используется поле стандартного блока действий (см. Рисунок 20);\nРисунок 20 — Ввод текстового сообщения для отправки\nПри нажатии на id сообщения (на представленном рисунке это «916») будет открыто окно редактирования, которое удобно использовать для ввода больших текстов рассылок.\n2. Медиа-контент — изображения, видео, аудио и документы, которые могут быть добавлены к сообщению. Поддерживаются наиболее распространенные форматы (см. таблицу 1).\nТаблица 1 — Рекомендуемые форматы файлов и их поддержка в мессенджерах\nТип Форматы Возможность загрузки файлов\nViber ВКонтакте Telegram Facebook* Instagram\n* Изображение JPG JPEG PNG Да Да Да Да Да\nВидео MP4 Да Нет Да Да Да\nАудио MP3 Да Нет Да Да Да\nДокумент PDF DOC(X) XLS(X) TXT Да Да Да Да Да\nВажно!\nСписок рекомендованных форматов, указанный в таблице 1, не является исчерпывающим. У каждого мессенджера есть свой список, который со временем может изменяться. Кроме того, необходимо учитывать, что мессенджеры имеют свои особенности отображения медиа-контента (например, Viber в некоторых случаях не позволяет просматривать изображения в мессенджере).\nОтправка возможна для всех видов контента. При этом, для всех видов контента, кроме изображений, отправляется только ссылка на него. Соответственно, клиент не сможет просматривать аудио, видео или документ прямо в мессенджере (для этого нужно будет воспользоваться браузером или другим приложением.\n19 В таблице приведены наиболее универсальные форматы, подходящие для отправки клиенту в большинство мессенджеров. Перед запуском рассылки для клиентов необходимо предварительно тестировать рассылки на всех мессенджерах.\nДополнительно нужно учитывать, что для некоторых мессенджеров важно, чтобы истинный формат файла соответствовал его расширению (т. е. чтобы изображение image.png действительно имело содержимое, предусмотренное форматом PNG, а не, например, данные в формате JPEG).\nДля добавления медиа-контента необходимо в блоке действий нажать на кнопку и в раскрывшемся меню выбрать пункт «Добавить медиа» (см. Рисунок 21).\nРисунок 21 — Переход к добавлению медиа-контента\nЗатем нужно задать тип медиа-контента и ввести ссылку (URL) на него, либо загрузить\nс компьютера при помощи кнопки (см. Рисунок 22).\nРисунок 22 — Добавление медиа-контента\n3. Медиа группа — изображения и видео, которые могут быть добавлены к сообщению группой.\nВ отличии от предыдущего пункта, медиа группа позволяет отправлять клиенту заранее не определенное количество изображений и видео. Это удобно, например, для информирования клиентов о результате проведенных работ, когда одному\n20 клиенту нужно отправить 10 фотографий, а другому 15. С помощью медиа групп это можно сделать одной рассылкой\n.\nВторое отличие от одиночных медиа состоит в том, что с медиа группа отправляются клиенту одним сообщением\n, тогда как одиночные медиа отправляются каждое в отдельном сообщении.\nВ группах могут отправляться только изображения и видео, документы и аудио отправляться не могут.\nДля добавления группы необходимо в блоке действий нажать на кнопку и в раскрывшемся меню выбрать пункт «Добавить медиа группу» (см. Рисунок 23).\nРисунок 23 — Добавление медиа группы\nВ открывшемся окне можно добавлять и редактировать ссылки на файлы, которые будут отправляться вместе с указанным сообщением (Рисунок 24).\nРисунок 24 — Редактор медиа групп\nДля реализации этого сценария необходимо использовать макросы, см. в\nразделе «Использование макросов»\nВозможности просмотра одиночных и групп медиа («карусель», предпросмотр в виде плиток и т.д.) зависят от мессенджера.\n21 В поле URL можно вставить как сам URL изображения, так и макрос (подробнее о макросах в\nразделе «Использование макросов»\n).\nДля загрузки файлов с устройства используется кнопка . Для клонирования\nэлементов – . Для выбора типа файла необходимо нажать на иконку и в появившемся списке выбрать тип: изображение, видео или макрос.\nЗагруженные элементы отображаются справа. В правой области элементы можно как удалять при наведении мышки и нажатии на кнопку корзины, так и перемещать – кликнув мышкой на элемент и перетянуть в нужное место см. Рисунок 25.\nВ левой области также можно перетаскивать элементы и менять их\nпоследовательность. Для этого необходимо кликнуть мышкой на элемент и перетащить его в нужное место.\nРисунок 25 — Взаимодействие с элементами в правой панели\nВажно!\nМаксимальное количество элементов в медиа группе равно 50. К одному текстовому сообщению может быть присоединена только одна медиа группа.\nВо всех полях медиа группы можно использовать\nмакросы\n.\nРассмотрим случай, когда рассылка с медиа группой будет отправляться клиентам по событию.  Ссылки на изображения мы хотим задавать динамически, в аргументах события, чтобы мы могли отправить одному клиенту 11 фотографий, а другому 20 из одной рассылки. Для этого необходимо:\n1.\nСоздать событие\n, у которого будет 30 аргументов (это будет максимальное число изображений в медиа группе в этом примере) (Рисунок 26);\nРисунок 26 — Создание события для отправки изображений в медиа группе\n2. Создать рассылку и настроить ее на\nначало по этому событию\n;\n3. В конструкторе рассылки в блок добавить медиа группу;\n4. В медиа группу добавить то же самое количество URL, что и в аргументах события (см. Рисунок 27);\nРисунок 27 — Использование макросов с изображениями\n5. В поле URL ввести аргументы события в фигурных скобках, указав в каждом поле только один аргумент, тип файла оставить как изображение (см. Рисунок 27);\n6. Сохранить медиа группу.\n23 После этого необходимо\nсгенерировать событие\nи в аргументах события указать ссылки на файлы для отправки клиенту в мессенджер см. Рисунок 28.\nРисунок 28 — Генерация события с аргументами\nЕсли рассылка должна отправлять не только изображения в медиа группе, но и видео, тогда в макросах нужно передавать еще и тип медиа. Для этого в аргументах события необходимо создать в два раза больше аргументов, чтобы для каждого URL передавался еще и тип, например см. Рисунок 29:\nРисунок 29 — Создания аргументов события для медиа группы\nВ настройках медиа группы для каждого URL выбираем тип \"Макрос\" и задаем URL и его тип макросами, как показано на Рисунок 30.\nРисунок 30 — Создания медиа группы с разными типами\nПосле этого необходимо\nсгенерировать событие\nи в аргументах события указать ссылки на файлы и типы для отправки клиенту в мессенджер, например, см. Рисунок 31.\nРисунок 31 — Генерация события для медиа группы с типами медиа\n4. Кнопки-действия — это кнопки, позволяющие выполнять следующие действия:\n• Вызвать другой блок действий;\n• Добавить клиенту теги;\n• Снять теги с клиента;\n• Отписать клиента от рассылок (всех)\n.\nДля добавления кнопки-действия необходимо в блоке действий нажать на кнопку и в раскрывшемся меню выбрать пункт «Добавить кнопку-действие» (см. Рисунок 32).\nДействие эквивалентно тому, что клиент напишет боту команды «стоп рассылки» или «stop subscriptions», см. раздел\nОтписка от рассылок\n.\nРисунок 32 — Переход к добавлению кнопки-действия\nЗатем нужно задать требуемые параметры кнопки и нажать на кнопку «Сохранить» (см. Рисунок 33). Для каждой кнопки можно указать теги, которые будут назначены клиенту (сняты с клиента), подробнее об этом см. в подразделе\nРабота с тегами\n.\nРисунок 33 — Добавление кнопки-действия\nПримечание:\nДлина заголовка кнопки должна быть не более 20 символов.\nДействия в блоке, связанном с кнопкой, всегда выполняются сразу после нажатия кнопки. (см. Рисунок 34). Блок, вызываемый кнопкой-действием, может содержать любое из действий, описанных в разделе\nБлоки действий\n.\nРисунок 34 — Второй блок выполняется сразу при нажатии на кнопку\nНа одну кнопку клиент может нажать только один раз. Повторные нажатия не обрабатываются. Если сценарий рассылки предусматривает возврат к блоку, который клиент уже получал, то на кнопку можно будет нажать еще раз (см. Рисунок 35). В этом примере при нажатии на кнопку «Назад» клиент получит первый блок еще раз и именно в нем можно будет еще раз нажать на кнопку «Подробнее».\nРисунок 35 — Пример возврата\nПри добавлении к сообщению более двух кнопок-действий появляется опция «Разрешить только одно нажатие» (см. Рисунок 36).\nЕсли она установлена, то клиент может нажать только на одну кнопку в этом сообщении. После первого нажатия аналогичные нажатия по другим кнопкам не обрабатываются. Если опция не установлена, то на каждую кнопку в сообщении можно нажать один раз.\nРисунок 36 — В блок добавлено две кнопки-действия\nВажно!\nОписанное выше относится только к кнопкам сообщения, а не блока. В один блок может быть добавлено несколько сообщений, каждое из которых будет содержать по нескольку кнопок. В этом случае при включенной опции «Разрешить только одно нажатие» в каждом сообщении можно будет нажать по одной кнопке.\nВ некоторых мессенджерах текст сообщений с кнопками может обрезаться. Т.е. клиент увидит не весь отправленный ботом текст, а только первые несколько символов. Предупреждение об этом всплывет справа у окна с текстом см. Рисунок 37. Например, в мобильной версии Viber будет отображаться только первые 40 символов сообщения с кнопкой, а в десктопной версии – первые 10.\nРисунок 37 - Текст с кнопкой, который обрежется в некоторых мессенджерах\nЧтобы обойти эту проблему рекомендуем добавлять отдельное сообщение перед сообщением с кнопкой и задавать в нем основной текст, а в сообщении с кнопкой писать что-то короткое см. Рисунок 38.\nРисунок 38 - Добавлено отдельное сообщение\n5. Кнопки-ссылки — кнопки, позволяющие клиенту перейти по заданной ссылке из мессенджера.\nДля добавления кнопки-ссылки необходимо в блоке действий нажать на кнопку и в раскрывшемся меню выбрать пункт «Добавить кнопку-действие» (см. Рисунок 39).\nРисунок 39 — Переход к добавлению кнопки-ссылки\nЗатем необходимо задать название кнопки и ссылку для нее (см. Рисунок 40).\nРисунок 40 — Создание кнопки-ссылки\n29 Ссылка клиенту не отображается. Нажатия на кнопку-ссылку не могут приводить к запуску другого блока или иным действиям, а также никак не учитываются в статистике.\nПримечание:\nКлиент может нажимать на ссылки многократно, описанные выше ограничения по нажатиям на них не действуют.\nОтправка сообщения, содержащего конфиденциальные данные для клиента\nВ общем случае вся переписка клиента с ботом доступна оператору Maxbot. Если бот используется для отправки конфиденциальной информации (например, кодов подтверждения), то такую информацию необходимо скрывать от оператора.\nДля отправки конфиденциальной информации в теле блока с сообщением необходимо использовать тег <security>…</security> (см Рисунок 41). Вставка закрывающего тега обязательна.\nРисунок 41 — Отправка конфиденциальной информации при помощи тега <security></security>\nДанные, заключенные в теге <security>, для оператора заменяются на ***. То, что увидят клиент и оператор при запуске такой рассылки, показано на рисунке ниже:\nРисунок 42 — Отображение содержимого тега <security> для клиента и для оператора\nНа практике использование тега <security> будет сопровождаться использованием\nмакроса\n, т. е. конфиденциальная информация вряд ли будет задаваться в рассылке статически. В этом случае тег <security> нужно использовать следующим образом (см. Рисунок 43), поместив внутрь макрос, который является аргументом события:\nРисунок 43 — Использование значения макроса в качестве конфиденциальной информации\nПеревод в канал\nДействие перевода в канал выполняется сразу, если диалог у клиента закрыт или диалог свободный\nили иное на задано в настройках действия (см. далее). При наличии открытого диалога перевод выполнен не будет, чтобы не помешать текущему общению клиента с оператором. Перевод будет отложен до тех пор, пока диалог у клиента не будет закрыт или не будут выполнены условия, заданные в настройках действия.\nДля добавления действия перевода в канал нужно нажать на кнопку и в раскрывшемся меню выбрать пункт «Действие», после чего выбрать «Перевести в канал» (см. Рисунок 44):\nРисунок 44 — Выбор действия\nЗатем в открывшемся окне (см. Рисунок 45) необходимо задать параметры для действия перевода в канал.\nВ окне доступны следующие настройки:\n• Выберите канал — канал, в который необходимо перевести клиента;\nСвободный диалог — диалог, у которого канал Bot.\n• Текст при переводе в канал — сообщение, которое будет отправлено клиенту при переводе в канал (если оставить его пустым, то сообщение не будет отправляться);\n• Текст при откладывании перевода в канал — сообщение, которое будет оправлено клиенту, если в момент выполнения действия у него есть открытый диалог и он не свободный (т. е. клиент обсуждает с оператором или ботом какой-то вопрос);\n• Текст перед отложенным переводом в канал — сообщение, которое будет отправлено клиенту при переводе в канал, если он ранее был отложен;\n• Переключатель условия перевода в канал:\n• Перевести сразу (значение по умолчанию) — клиент будет переведен в канал без каких-либо дополнительных условий (кроме наличия открытого/свободного диалога);\n• Перевести после получения сообщения от клиента — клиент будет переведен только после получения от него сообщения и в соответствии с настройками, указанными ниже;\nРисунок 45 — Настройка действия перевода в канал\n• Время ожидания сообщения — время, которое бот ожидает сообщения от клиента для перевода его в канал. Можно установить время не более 2 часов (ограничение введено, чтобы маркетолог не мог надолго «блокировать» клиента: поскольку в момент ожидания не могут выполняться другие рассылки, а также клиенту не смогут отправлять сообщения операторы);\n• Если клиент не ответил за заданное время — действие, которое бот выполнит, не дождавшись сообщения от клиента в течение «времени ожидания сообщения»:\n• «Ничего не делать» — бот не будет предпринимать каких-либо действий; клиент не будет переведен в канал, рассылка при этом продолжится согласно сценарию;\n• «Перевести в канал безусловно» — клиент будет переведен в канал, при этом можно задать другой канал (отличный от исходно заданного);\n• «Отправить сообщение» — клиенту будет отправлено сообщение, заданное в поле ниже; клиент не будет переведен в канал.\nЕсли для рассылки ниже (см. Рисунок 46) задать безусловный перевод клиента в канал по факту нажатия на кнопку «Оставить отзыв», то клиент будет переведен сразу, какого- либо сообщения от него не требуется.\nРисунок 46 — Пример рассылки с переводом в канал\nВ этом случае оператор увидит нового клиента в списке диалогов, но сообщение от клиента будет отсутствовать (см. Рисунок 47).\nРисунок 47 — Клиент переведен в канал без сообщения\n33 Если же в настройках перевода в канал потребовать ввод сообщения от клиента (см. Рисунок 48), то новый диалог появится только после отправки клиентом сообщения.\nРисунок 48 — Ввод условия перевода клиента в канал только при наличии от него сообщения\nВ этом случае оператор уже сразу увидит текст сообщения и не будет тратить время на выяснение причины и содержания обращения (см. Рисунок 49).\nРисунок 49 — Клиент переведен в канал после отправки им сообщения\nОтмена отправки запланированных сообщений\nЭто действие позволяет маркетологу остановить рассылку для клиента при возникновении некоторого события. Например, при нажатии кнопки, при отправке финального сообщения рассылки, при истечении определенного времени.\nДля добавления действия нужно нажать на кнопку и в раскрывшемся меню выбрать пункт «Действие», после чего выбрать «Отключить рассылку запланированных, но еще не отправленных сообщений» (см. Рисунок 50):\nРисунок 50 — Выбор действия\nНа рисунке 51 показан пример такого сценария. Если клиент нажмет на кнопку «Не интересуюсь этим», робот отправит извинительное сообщение и отключит отправку запланированных сообщений. В данном случае это правое нижнее сообщение, которое предполагалось отправить через 5 дней.\nЕсли клиент в течение 5 дней не нажмет эту кнопку, то он получит запланированное сообщение с информацией о продлении акции.\nРисунок 51 — Пример использования события отмены отправки запланированных сообщений\nВажно!\nДействие отмены отправки запланированных сообщений применяется ко всей рассылке для текущего клиента, независимо от того, из какой ветви сценария оно было вызвано.\nОтмена работы уже отправленных в рассылку кнопок\nЭто действие работает аналогично предыдущему, только отменяет не отправку сообщений, а работу кнопок в сообщениях. Вместе с предыдущим действием позволяет полностью деактивировать рассылку для клиентов, у которых они будут выполнены.\nДля добавления действия нужно нажать на кнопку и в раскрывшемся меню выбрать пункт «Действие», после чего выбрать «Отключить работу уже отправленных в рассылку кнопок» (см. Рисунок 52):\nРисунок 52 — Выбор действия\nВ следующем сценарии (см. Рисунок 53) при нажатии на кнопку «Не интересуюсь этим» произойдет не только отмена запланированного сообщения, но и перестанет работать кнопка, отправленная клиенту в первом сообщении.\nРисунок 53 — Использование действия отмены работы уже отправленных в рассылку кнопок\n36 Важно!\nЭто действие отменяет только работу кнопок-действий. Кнопки-ссылки будут всегда доступны, клиенты смогут переходить по ним произвольное число раз.\nДействие отмены работы кнопок применяется ко всей рассылке для текущего клиента, независимо от того, из какой ветви сценария оно было вызвано.\nВызов внешней системы\nДействие «Вызвать внешнюю систему» предназначено для уведомления внешней системы о достижении клиентом того или иного этапа рассылки.\nДля добавления вызова внешней системы нужно нажать на кнопку и в раскрывшемся меню выбрать пункт «Действие», после чего выбрать «Вызвать внешнюю систему» (см. Рисунок 54).\nРисунок 54 — Выбор действия\nДалее необходимо задать параметры запроса к внешней системе. Для примера далее заполнено обращение к CRM компании для того, чтобы отметить интерес клиента к определенной теме в случае нажатия на определенную кнопку (см. Рисунок 55). В дальнейшем в CRM это можно будет использовать для сегментации аудитории.\nПример ниже отражает вариант запроса, при выполнении которого в CRM компании сохраняются данные о том, что клиент с идентификатором 12443 интересуется товарами в категории «наушники» (headphones).\nКроме строковых и числовых параметров также могут использоваться макросы, см. подробнее в разделе\nИспользование макросов\n.\nРисунок 55 — Ввод параметров запроса к внешней системе\nЕсли в блоке есть действие вызова внешней системы, то оно всегда выполняется первым. Если вызов завершается ошибкой (сервер возвращает HTTP-статус, отличный от 200 или не отвечает в течение времени, заданного в поле «Максимальное время выполнения запроса»), то остальные действия блока не выполняются. Если к текущем блоку привязаны последующие блоки (т. е. выполняются после отправки сообщения из этого блока), то они также не будут выполнены.\nПримечание:\nВ текущей версии «Максимальное время выполнения запроса» и все подобные таймауты временно равны 0.5 секунды вне зависимости от заданного значения.\nГенерация события\nБлок этого типа позволяет вызывать события и использовать их для запуска других рассылок из текущей рассылки.\nЕсли клиент по сценарию рассылки перейдет к действию «Сгенерировать событие», то это событие будет сгенерировано либо только для него; если для события задана фиксированная аудитория (см. подробнее в разделе\nОпределение аудитории\n), то событие будет сгенерировано для нее (будет запущена рассылка для множества\n38 клиентов). Это позволит начать одну или несколько других рассылок. Текущая рассылка при этом не будет остановлена, ее сценарий продолжит выполняться.\nРисунок 56 — Выбор действия «Сгенерировать событие\nНапример, есть рассылка, предлагающая клиенту воспользоваться промокодом (см. Рисунок 57). Если клиент нажимает на кнопку, то во втором блоке рассылки генерируется событие «Создание промокода для клиента».\nПримечание:\nСобытие, используемое в сценарии рассылки, должно быть предварительно создано. Подробнее об этом см. в разделе\nИспользование событий\n.\nРисунок 57 — Рассылка, в сценарии которой генерируется событие для клиента\nВ аргументах события, генерируемого для клиента, нужно задать требуемые значения. В нашем случае нужно задать значения для 3-х аргументов (см. Рисунок 58):\n• промокод — строка;\n• размер скидки (%) — число;\n• действует до — строка.\nРисунок 58 — Событие «Создание промокода для клиента» и его аргументы\nПример ввода значений аргументов события показан на рисунке 59.\nПри указании строковых значений необходимо использовать символ кавычек (“); числовые значения и даты задаются без кавычек. Значение аргумента также может быть пустым (не задано).\nПри этом могут быть заданы как статические значения аргументов (в примере выше), так и динамические —\nмакросы\n, уникальные для каждого клиента.\nПереключатель под названием события определяет, для кого будет сгенерировано событие:\n• только для текущего клиента\nили\n• для множества клиентов (для рассылок с фиксированной аудиторией).\nРисунок 59 — Ввод аргументов для события\nТеперь можно создать вторую рассылку, которая будет выполняться при генерации события в первой рассылке. Ниже пример такой рассылки (см. Рисунок 60):\nРисунок 60 — Вторая рассылка, запускаемая по сгенерированному событию и использующая значения аргументов события\nПримечание:\nЕсли рассылка запускается по событию, то его аргументы можно использовать в рассылке как макросы. На рисунке выше во второй рассылке при помощи скобок {{ }} используются значения аргументов сгенерированного события.\nДля данной рассылки нужно выбрать условие «Начинать при возникновении события» и событие «Создание промокода для клиента» (см. Рисунок 61), после чего запустить ее. Рассылка будет «ожидать» выбранного события и выполнится у клиентов, для которых оно наступило.\nРисунок 61 — Определение условий начала второй рассылки\nЕсли в результате выполнения первой рассылки (см. Рисунок 57) клиент нажмет кнопку «Получить промокод», то в результате выполнения второй рассылки будут получены данные промокода (см. Рисунок 62).\nРисунок 62 — После нажатия на кнопку «Получить промокод» для клиента выполнилась вторая рассылка\nГенерация интента\nБлок этого типа позволяет сгенерировать интент (intent) — намерения пользователя, которые могут быть распознаны системой для того, чтобы затем вызвать определенный навык бота.\n42 Для вызова навыков бота необходимо:\n1. Нажать на кнопку и в раскрывшемся меню выбрать пункт «Действие», после чего выбрать «Сгенерировать intent» (см. Рисунок 63).\nРисунок 63 — Выбор действия «Сгенерировать intent»\n2. В настройках действия (см. Рисунок 64) задать название интента и (необязательно) словарь сущностей (entities). Важно, что в поле «Entities» должен быть задан именно словарь в формате JSON (как на рисунке ниже), иначе выполнение сценария рассылки завершится ошибкой.\nВ словаре могут быть использованы как макросы и переменные окружения (в нотации «slots.m.macros_name»), так и статические значения. Этот словарь должен быть валидным jinja-выражением.\nКонстантные выражения также нужно задавать правильно — строки только в кавычках, числа — без, и они не должны оставаться пустыми.\nРисунок 64 — Ввод параметров интента\n43 3. Нажать на кнопку «Сохранить».\nВ результате выполнения этого действия бот сгенерирует указанный интент и передаст slots в качестве параметров. Это позволит запустить нужный навык бота для клиента (например, выбор определенного товара или услуги).\nПримечание:\nЧтобы бот выполнил определенное действие, навыки бота должны быть предварительно настроены.\nВ перспективе это действие должно вытеснить большинство переводов в канал – вместо того, чтобы передавать клиента оператору и занимать его время, рассылка будет вызывать соответствующий навык бота.",
      "score": 0.6625086045265197,
      "node_ids": [
        "chunk_ch0176",
        "chunk_ch0180",
        "chunk_ch0337",
        "chunk_ch0191",
        "chunk_ch0366",
        "chunk_ch0175",
        "chunk_ch0273",
        "chunk_ch0336",
        "chunk_ch0358",
        "chunk_ch0389"
      ]
    },
    {
      "section_id": "section_ch1188",
      "title": "Поля, в которых можно использовать макросы",
      "text": "Поля, в которых можно использовать макросы\nМакросы можно использовать почти во всех текстовых полях конструктора рассылок:\n• Тексты сообщений;\n• Заголовки кнопок;\n• URL для кнопок-ссылок;\n• URL для медиа-контента;\n• Сообщения при переводе в канал;\n• Большинство полей настроек вызова внешней системы (кроме названий заголовков запроса и названий параметров запроса);\n• Аргументы события при генерации событий;\n• Все текстовые поля SMS-блока и настройки вызова внешней системы в SMS-блоке\n• Многие текстовые поля других действий\n.\nВозможности использования макросов в них описываются отдельно в описании каждого действия.",
      "score": 0.5934712862968444,
      "node_ids": [
        "chunk_ch1188",
        "chunk_ch1189",
        "chunk_ch1202"
      ]
    },
    {
      "section_id": "section_ch1247",
      "title": "Использование макросов в настройках вызова внешней системы и в действии генерации события",
      "text": "Использование макросов в настройках вызова внешней системы и в действии генерации события\nВ настройках вызова внешней системы и в действии генерации события использование макросов имеет ряд особенностей.\nВ полях настроек вызова внешней системы:\n• Адрес;\n• Текст сообщения в случае ошибки;\n• Значение заголовка запроса\nмакросы задаются как обычно, в двойных фигурных скобках. Например:\n{{ macros_1 }}\nПример заполнения показан на рисунке ниже (см. Рисунок 138):\nРисунок 138 — Использование макросов при вызове внешней системы\nПоля настройках вызова внешней системы:\n• Значение параметра запроса;\n• Тело запроса\n106 а также аргументы генерируемых из рассылки событий являются вычислимыми jinja- выражениями, и параметры запросов задаются там с приставкой «slots.m.» и без фигурных скобок:\nslots.m.macros_1\nТак, например, можно задать следующее тело запроса:\n{\n\"Macros 1\": slots.m.macros_1,\n\"Macros 2\": slots.m.macros_2,\n\"Some details\":[\nprofile.customer_messenger_id,\nprofile.messenger_type,\nslots.m.macros_3\n]\n}\nИли аргумент события:\nРисунок 139 — Определение аргумента для события",
      "score": 0.5734603977203369,
      "node_ids": [
        "chunk_ch1254",
        "chunk_ch1253",
        "chunk_ch1247",
        "chunk_ch1248",
        "chunk_ch1264",
        "chunk_ch1265",
        "chunk_ch1261",
        "chunk_ch1256",
        "chunk_ch1269"
      ]
    },
    {
      "section_id": "section_ch1204",
      "title": "Создание и удаление макросов рассылки",
      "text": "Создание и удаление макросов рассылки\nЯвного способа создания и удаления макросов в рассылке нет. Макросы создаются при упоминании в одном из перечисленных ранее полей.\nМакрос может состоять из латинских букв, цифр, подчеркивания и обрамляется двойной фигурной скобкой.\nМаркетолог может создать рассылку и в первом же сообщении написать «{{ abc }}». В этом случае в рассылке будет создан макрос abc. Если маркетолог удалит этот макрос из всех текстовых полей, то макрос удалится.",
      "score": 0.5291423773765563,
      "node_ids": [
        "chunk_ch1204",
        "chunk_ch1205",
        "chunk_ch1207",
        "chunk_ch1206"
      ]
    },
    {
      "section_id": "section_ch1217",
      "title": "Определение значений макросов для клиентов",
      "text": "Определение значений макросов для клиентов\nДля рассылок со статической аудиторией значения макросов задаются в JSON или CSV- файлах, определяющих аудиторию рассылки.\nДля рассылок, начинающихся по событию, значения макросов передаются в аргументах события. Например, если рассылка началась по событию «Создание промокода для клиента» (см. Рисунок 135), то в теле рассылки могут быть использованы макросы {{code}}, {{discount}} и {{valid_thru}}.\nРисунок 135 — Аргументы события являются макросами для рассылки",
      "score": 0.5192571258544921,
      "node_ids": [
        "chunk_ch1217",
        "chunk_ch1219"
      ]
    },
    {
      "section_id": "section_ch1208",
      "title": "Проверка наличия макросов",
      "text": "Проверка наличия макросов\nВ консоли маркетолога реализована система проверки наличия макросов, целью которой является не дать маркетологу запустить рассылку, в которой для клиентов не заданы какие-либо макросы, либо неверно определены их значения. При этом значения макросов в файле аудитории могут быть и пустыми.\nПроверки работают следующим образом:\n1. Если аудитория задается статично, то пока ни одного клиента не задано в рассылку можно добавлять любые макросы. Однако, при загрузке аудитории все заданные макросы должны быть у всех добавляемых в рассылку клиентов. Иначе при загрузке аудитории маркетолог увидит ошибку.\n2. Если аудитория задается статично, и аудитория рассылки уже задана, то в рассылку можно добавлять только те макросы, значения которых есть у всех клиентов из аудитории рассылки. При попытке использовать в тексте отсутствующий хотя бы у одного клиента макрос маркетолог получит ошибку.\n3. Если рассылка начинается при выставлении тега или при получении ключевого слова, то использование макросов недопустимо. Т. к. нет способа задавать значения этих макросов.\n4. Если рассылка начинается при возникновении события, то в рассылку можно добавлять только макросы, названия которых совпадают с именами аргументов события, по которому стартует рассылка. При попытке использовать другой макрос возникнет ошибка. При попытке удалить аргумент события, который используется в рассылке, возникнет ошибка. При попытке сменить событие, по которому запускается рассылка, требуется чтобы у нового события были все аргументы, которые используются в рассылке.\n5. Если рассылка имеет фиксированную аудиторию и начинается по событию, то макросы берутся и из фиксированной аудитории, и из аргументов события. При этом они не могут пересекаться, т. е. нельзя загрузить аудиторию с определенным макросом и использовать одноименный аргумент в событии.",
      "score": 0.5077571845054626,
      "node_ids": [
        "chunk_ch1208",
        "chunk_ch1209"
      ]
    },
    {
      "section_id": "section_ch0113",
      "title": "Настройка сценария рассылки",
      "text": "Настройка сценария рассылки\nКонструктор позволяет задать сценарий рассылки, который будет выполняться для каждого клиента из аудитории рассылки.\nСценарий рассылки состоит из:\n• события Start;\n• блоков действий;\n• связей между блоками действий.\nПри создании рассылки в конструкторе автоматически создается событие Start, которое является начальной точкой выполнения сценария рассылки. Также в редакторе отображается кнопка «Добавить блок», при помощи которой в рассылку добавляются блоки действий. События и блоки действий соединяются при помощи мыши, образуя связи.\nВ простейшем случае сценарий рассылки представляет собой событие Start, связанное с одним блоком действий (см. Рисунок 19).\nРисунок 19 — Создан сценарий простейшей рассылки",
      "score": 0.5077454996109008,
      "node_ids": [
        "chunk_ch0113",
        "chunk_ch0119",
        "chunk_ch0115",
        "chunk_ch0116",
        "chunk_ch0122",
        "chunk_ch0114",
        "chunk_ch0120"
      ]
    },
    {
      "section_id": "section_ch0434",
      "title": "Дублирование блоков",
      "text": "Дублирование блоков\nЕсли необходимо быстро скопировать блок со всем его содержимым, то необходимо в верхней части нажать на и затем в раскрывшемся меню выбрать «Дублировать» (см. Рисунок 71).\nРисунок 71 — Вызов функции дублирования блока",
      "score": 0.32599264144897455,
      "node_ids": [
        "chunk_ch0434"
      ]
    }
  ]
}