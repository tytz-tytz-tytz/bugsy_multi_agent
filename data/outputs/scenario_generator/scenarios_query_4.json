[
  {
    "id": "SCN-001",
    "title": "Создание и запуск рассылки с фиксированной аудиторией через JSON",
    "steps": [
      "Создать JSON-файл с аудиторией, содержащий массив customers. Для одного клиента указать все поля: id, phone, messengers_order. Для другого клиента указать только phone и messengers_order. Для третьего клиента указать только phone.",
      "Создать рассылку с условием начала 'фиксированная аудитория' и загрузить подготовленный JSON-файл.",
      "Запустить рассылку.",
      "Попытаться добавить нового клиента в аудиторию запущенной рассылки через редактирование JSON или интерфейс.",
      "После завершения или остановки рассылки попытаться запустить её повторно."
    ],
    "expected_result": "Система корректно обрабатывает JSON: для первого клиента использует id, игнорируя phone и messengers_order; для второго и третьего — использует указанные поля. После запуска рассылки добавление новых клиентов в фиксированную аудиторию отклоняется. Повторный запуск той же рассылки с фиксированной аудиторией невозможен.",
    "attributes_covered": [
      "AUD-001",
      "AUD-002",
      "AUD-004",
      "AUD-005"
    ]
  },
  {
    "id": "SCN-002",
    "title": "Работа с динамической аудиторией на основе системного события",
    "steps": [
      "Создать рассылку с условием начала 'динамическая аудитория' на системное событие 'client_added'.",
      "Запустить рассылку.",
      "Добавить в систему несколько новых клиентов (например, 1500).",
      "Проверить статусы рассылки и убедиться, что все добавленные клиенты стали получателями."
    ],
    "expected_result": "Рассылка запускается. Каждое добавление нового клиента генерирует системное событие 'client_added', и все новые клиенты (без ограничения количества) включаются в динамическую аудиторию рассылки и получают сообщения.",
    "attributes_covered": [
      "AUD-003",
      "EVT-002"
    ]
  },
  {
    "id": "SCN-003",
    "title": "Управление пользовательским событием, связанным с рассылкой",
    "steps": [
      "Создать пользовательское событие 'test_purchase' с аргументом 'amount' типа number.",
      "Создать и запустить рассылку с динамической аудиторией на событие 'test_purchase'.",
      "Попытаться удалить событие 'test_purchase' через интерфейс.",
      "Попытаться изменить аргумент события 'test_purchase' (например, изменить тип 'amount' на string) через API.",
      "Остановить рассылку.",
      "Попытаться удалить событие 'test_purchase' после остановки рассылки."
    ],
    "expected_result": "Пока рассылка активна, удаление события 'test_purchase' запрещено. Редактирование аргументов события через API во время работы рассылки возвращает ошибку (например, статус 409). После остановки рассылки удаление события становится возможным.",
    "attributes_covered": [
      "EVT-003",
      "EVT-004"
    ]
  },
  {
    "id": "SCN-004",
    "title": "Генерация события для тестирования через интерфейс и API",
    "steps": [
      "В интерфейсе консоли маркетолога перейти в раздел 'Тестирование рассылок'.",
      "Выбрать существующее пользовательское событие, заполнить форму аргументов корректными значениями (соответствующими типам).",
      "Нажать 'Сгенерировать'.",
      "Проверить, что в ответе отображаются идентификаторы запусков (flow_ids) и есть кнопка для копирования curl-запроса.",
      "Скопировать curl-запрос и выполнить его в терминале.",
      "Изменить curl-запрос, передав аргумент с неверным типом (например, строку вместо числа).",
      "Выполнить некорректный запрос и проверить ответ."
    ],
    "expected_result": "При генерации через интерфейс успешно возвращаются идентификаторы запусков и предоставляется возможность скопировать curl. Выполнение скопированного curl-запроса через API также успешно. При отправке запроса с аргументом неверного типа API возвращает ошибку с кодом 409.",
    "attributes_covered": [
      "EVT-005",
      "EVT-008",
      "UI-001",
      "UI-002"
    ]
  },
  {
    "id": "SCN-005",
    "title": "Отложенные события для новых и существующих клиентов",
    "steps": [
      "Сгенерировать отложенное событие 'welcome_back' по номеру телефона +79001112233, который НЕ существует в системе, с ttl=1 час.",
      "Сгенерировать отложенное событие 'welcome_back' по номеру телефона +79004445566, который УЖЕ существует в системе и имеет подтвержденные мессенджеры Telegram и WhatsApp (приоритет: Telegram первый).",
      "Для несуществующего номера (+79001112233) зарегистрировать и подтвердить клиента в течение часа (например, через 30 минут).",
      "Проверить статусы запусков рассылок для обоих случаев."
    ],
    "expected_result": "Для существующего клиента рассылка по отложенному событию запускается немедленно, и сообщение отправляется через Telegram (приоритетный подтвержденный мессенджер). Для нового номера, после подтверждения клиента в течение ttl, рассылка запускается, и приоритет мессенджеров учитывается среди подтвержденных.",
    "attributes_covered": [
      "EVT-006",
      "EVT-007"
    ]
  },
  {
    "id": "SCN-006",
    "title": "Попытки изменения системных событий",
    "steps": [
      "Через API попытаться изменить название системного события 'client_added'.",
      "Через интерфейс попытаться удалить системное событие 'phone_confirmed'.",
      "Проверить, что системные события по-прежнему отображаются в списке и могут быть выбраны при создании рассылки."
    ],
    "expected_result": "Попытки изменить или удалить системные события отклоняются системой (например, API возвращает ошибку 403). Системные события остаются доступными и неизменными.",
    "attributes_covered": [
      "EVT-001"
    ]
  }
]