[
  {
    "id": "SCN-001",
    "title": "Создание и проверка SMS-провайдеров разных типов",
    "steps": [
      "Перейти в раздел 'SMS-провайдеры'.",
      "Нажать кнопку создания нового провайдера.",
      "Проверить, что в выпадающем списке 'Тип' присутствуют варианты: SMSC, МТС, СМС услуги, SMS.ru.",
      "Выбрать тип 'SMSC'.",
      "Заполнить все обязательные поля (Название, Описание, Логин, Пароль, Отправитель) корректными тестовыми данными.",
      "Нажать 'Сохранить' и убедиться, что провайдер создан.",
      "Повторить шаги 2-6 для типа 'МТС' с корректными данными.",
      "Попробовать сохранить провайдера с пустым полем 'Логин' и проверить появление ошибки валидации."
    ],
    "expected_result": "Система поддерживает создание провайдеров типов SMSC и МТС при заполнении всех обязательных полей. При пустом обязательном поле 'Логин' сохранение блокируется с ошибкой.",
    "attributes_covered": [
      "EVT-001",
      "EVT-002"
    ]
  },
  {
    "id": "SCN-002",
    "title": "Настройка провайдеров 'СМС услуги' и 'SMS.ru' с особенными полями",
    "steps": [
      "В разделе 'SMS-провайдеры' начать создание нового провайдера.",
      "Выбрать тип 'СМС услуги'.",
      "В поле 'Логин' ввести произвольную строку (например, 'test123').",
      "В поле 'Пароль' ввести валидный тестовый токен.",
      "В поле 'Отправитель' выбрать существующее имя отправителя из выпадающего списка (предварительно добавленного в 'Рассылка СМС' -> 'Имена отправителя').",
      "Сохранить провайдера и убедиться в успешном создании.",
      "Попробовать ввести в поле 'Отправитель' несуществующее имя и проверить реакцию системы.",
      "Создать нового провайдера типа 'SMS.ru'.",
      "В поле 'Отправитель' ввести зарегистрированного отправителя (например, 'MyBrand').",
      "В поле 'Пароль' ввести корректный api_id.",
      "Сохранить провайдера.",
      "Попробовать ввести некорректный api_id в поле 'Пароль' и проверить реакцию системы."
    ],
    "expected_result": "Провайдеры типов 'СМС услуги' и 'SMS.ru' создаются успешно при корректном заполнении полей согласно их особенностям (логин, токен/API ID, отправитель). При вводе некорректных данных (несуществующий отправитель, неверный API ID) система показывает ошибку и не сохраняет настройки.",
    "attributes_covered": [
      "EVT-003",
      "EVT-004"
    ]
  },
  {
    "id": "SCN-003",
    "title": "Добавление SMS-провайдера в рассылку и настройка SMS-блока",
    "steps": [
      "Создать SMS-провайдера любого типа (например, SMSC).",
      "Создать новую рассылку или открыть существующую.",
      "Перейти в раздел 'Условия начала рассылки' -> 'Расширенные настройки'.",
      "Проверить, что созданный провайдер доступен для выбора в соответствующем выпадающем списке, и выбрать его.",
      "Перейти в конструктор рассылки.",
      "Добавить SMS-блок в рассылку.",
      "Проверить, что кнопка добавления второго SMS-блока неактивна или скрыта.",
      "В SMS-блоке добавить два текстовых сообщения.",
      "Настроить ссылку на посадочную страницу: выбрать лендинг из списка, заполнить поля 'Текст до' и 'Текст после', установить время жизни ссылки.",
      "Сохранить настройки блока."
    ],
    "expected_result": "Созданный SMS-провайдер отображается и может быть выбран в расширенных настройках рассылки. В конструктор можно добавить только один SMS-блок, который поддерживает несколько текстовых сообщений и настройку ссылки на лендинг с дополнительными параметрами.",
    "attributes_covered": [
      "EVT-005",
      "EVT-006",
      "EVT-007",
      "EVT-008"
    ]
  },
  {
    "id": "SCN-004",
    "title": "Логика отправки SMS с флагами failback_to_sms и настройками аудитории",
    "steps": [
      "Создать рассылку с SMS-блоком и выбранным провайдером.",
      "В расширенных настройках рассылки убедиться, что флаг failback_to_sms установлен в false (по умолчанию).",
      "Загрузить аудиторию, содержащую клиента с подтвержденным номером телефона и подключенным мессенджером (например, WhatsApp).",
      "Запустить рассылку и проверить, что клиент получил сообщение в мессенджер, а SMS не отправлено.",
      "Изменить настройки аудитории в её файле: установить messengers_order: [] и failback_to_sms: true.",
      "Повторно загрузить обновленную аудиторию в рассылку.",
      "Запустить рассылку и проверить, что тот же клиент теперь получает SMS, несмотря на наличие мессенджера.",
      "Протестировать отправку SMS отписавшимся клиентам: в настройках аудитории установить unsubscribed_ttl=0, загрузить аудиторию с клиентом, отписавшимся от мессенджер-рассылок, и убедиться, что он получает SMS."
    ],
    "expected_result": "При failback_to_sms=false клиенты с мессенджерами получают сообщения в мессенджер, а SMS-блок игнорируется. При failback_to_sms=true и пустом messengers_order все клиенты получают SMS. При unsubscribed_ttl=0 отписавшиеся клиенты также получают SMS.",
    "attributes_covered": [
      "EVT-010",
      "EVT-011",
      "EVT-012"
    ]
  },
  {
    "id": "SCN-005",
    "title": "Ограничения и обработка ошибок в SMS-блоке",
    "steps": [
      "В конструкторе рассылки открыть добавленный SMS-блок.",
      "Попытаться вставить в текст сообщения переменную {{ profile.phone }} - убедиться, что она доступна и подставляется.",
      "Попытаться вставить переменные {{ profile.name }} и {{ thread.thread_id }} - проверить, что они недоступны для выбора или при сохранении/предпросмотре вызывают ошибку/игнорируются.",
      "Добавить в SMS-блок вызов внешней системы (если функционал предусмотрен).",
      "Смоделировать ошибку внешнего сервиса (например, вернуть 500).",
      "Запустить рассылку для тестового клиента.",
      "Проверить, что SMS-блок с ошибкой внешнего вызова не отправляется клиенту, клиент не получает сообщения об ошибке, и рассылка продолжает работу с другими блоками (если они есть).",
      "Ввести в SMS-блок очень длинное текстовое сообщение (более 160 символов).",
      "Запустить тестовую отправку и проверить, что провайдер разделил сообщение на несколько SMS, а не обрезал его."
    ],
    "expected_result": "В SMS-блоке доступна только переменная {{ profile.phone }}, другие переменные профиля и thread_id недоступны. При ошибке вызова внешней системы блок не отправляется, ошибка не показывается клиенту. Длинные сообщения автоматически разделяются провайдером на несколько SMS.",
    "attributes_covered": [
      "EVT-013",
      "EVT-014",
      "EVT-015"
    ]
  },
  {
    "id": "SCN-006",
    "title": "Интеграция лендинга в SMS и замена диплинка",
    "steps": [
      "В SMS-блоке рассылки настроить ссылку на существующую посадочную страницу (лендинг).",
      "Заполнить поля 'Текст до' и 'Текст после' ссылки.",
      "Установить время жизни ссылки (например, 24 часа).",
      "Сохранить SMS-блок.",
      "Выполнить тестовую отправку SMS на номер тестового клиента.",
      "Проверить полученное SMS: убедиться, что текст до и после ссылки отображается корректно.",
      "Перейти по ссылке из SMS и убедиться, что она ведет на страницу подтверждения номера телефона (диплинк подтверждения), а не на исходный URL лендинга."
    ],
    "expected_result": "Ссылка на лендинг в SMS настраивается с текстом и временем жизни. В отправленном SMS диплинк заменяется на диплинк подтверждения номера, ведущий на соответствующую страницу.",
    "attributes_covered": [
      "EVT-008",
      "EVT-009"
    ]
  }
]