[
  {
    "id": "SCN-001",
    "title": "Создание и базовое использование макроса в сообщении для статической аудитории",
    "steps": [
      "В конструкторе рассылок создать новую рассылку со статической аудиторией.",
      "В блоке действий добавить действие 'Отправка сообщения'.",
      "В текстовом поле сообщения ввести: 'Здравствуйте, {{customer_name}}! Ваша скидка: {{discount}}%'.",
      "Сохранить черновик рассылки.",
      "Перейти в раздел настройки макросов рассылки (или просмотреть список макросов).",
      "Загрузить файл аудитории (JSON/CSV), содержащий для всех клиентов столбцы 'customer_name' и 'discount' с корректными значениями (например, строковыми и числовыми).",
      "Запустить проверку или попытку запуска рассылки."
    ],
    "expected_result": "Макросы {{customer_name}} и {{discount}} автоматически появились в списке макросов рассылки. Система успешно прошла проверку и позволяет запустить рассылку. При тестовом просмотре для клиента из аудитории в тексте сообщения корректно подставляются значения из файла.",
    "attributes_covered": [
      "EVT-001",
      "EVT-002",
      "EVT-005",
      "EVT-008",
      "EVT-010"
    ]
  },
  {
    "id": "SCN-002",
    "title": "Управление жизненным циклом макроса: создание, изменение и удаление",
    "steps": [
      "Создать рассылку со статической аудиторией.",
      "В тексте сообщения использовать макрос {{promo_code}}.",
      "Сохранить черновик, убедиться, что макрос появился в списке.",
      "Изменить текст сообщения, удалив упоминание {{promo_code}} и добавив новый макрос {{client_id}}.",
      "Сохранить изменения.",
      "Проверить список макросов рассылки."
    ],
    "expected_result": "После первого сохранения макрос {{promo_code}} присутствует в списке макросов. После редактирования и сохранения макрос {{promo_code}} отсутствует в списке, а макрос {{client_id}} в нём появился.",
    "attributes_covered": [
      "EVT-001",
      "EVT-003"
    ]
  },
  {
    "id": "SCN-003",
    "title": "Валидация типов макросов и значений из аудитории",
    "steps": [
      "Создать рассылку со статической аудиторией.",
      "В тексте сообщения использовать макросы разных типов: {{order_date}} (date), {{total_sum}} (decimal), {{is_vip}} (boolean), {{status}} (categorical).",
      "Загрузить файл аудитории, где для всех клиентов заданы значения: корректная дата в ISO 8601 для order_date, число для total_sum, true/false для is_vip, одно из фиксированных значений для status.",
      "Запустить проверку рассылки.",
      "Попробовать загрузить альтернативный файл аудитории, где для одного клиента значение для {{order_date}} равно 'не дата'."
    ],
    "expected_result": "При корректном файле аудитории проверка проходит успешно. При загрузке файла с невалидным значением для макроса типа date система выводит ошибку валидации и не позволяет запустить рассылку.",
    "attributes_covered": [
      "EVT-004",
      "EVT-005",
      "EVT-008"
    ]
  },
  {
    "id": "SCN-004",
    "title": "Правила использования макросов для разных триггеров запуска (событие, тег)",
    "steps": [
      "Создать рассылку, запускаемую по событию 'Выдача купона' с аргументами 'coupon_code' и 'expiry_date'.",
      "В тексте сообщения использовать макросы {{coupon_code}} и {{expiry_date}}.",
      "Попробовать добавить в текст макрос {{customer_name}}.",
      "Сохранить/проверить конфигурацию.",
      "Создать другую рассылку, запускаемую по тегу 'приветствие'.",
      "Попробовать добавить в текст сообщения макрос {{user_name}}.",
      "Сохранить/проверить конфигурацию."
    ],
    "expected_result": "Для рассылки по событию использование макросов {{coupon_code}} и {{expiry_date}} допустимо, проверка проходит. Попытка использовать макрос {{customer_name}} вызывает ошибку валидации. Для рассылки по тегу попытка использовать любой макрос {{user_name}} блокируется системой с соответствующей ошибкой.",
    "attributes_covered": [
      "EVT-006",
      "EVT-007"
    ]
  },
  {
    "id": "SCN-005",
    "title": "Конфликт имен макросов в рассылке с фиксированной аудиторией и событием",
    "steps": [
      "Создать рассылку с фиксированной аудиторией (статический файл) и триггером по событию 'Обновление баланса' (аргумент: {{balance}}).",
      "Загрузить файл аудитории, содержащий макрос с именем {{balance}}.",
      "Попытаться сохранить или проверить конфигурацию рассылки.",
      "Изменить файл аудитории, заменив имя макроса на {{old_balance}}, не конфликтующее с аргументом события.",
      "Повторить попытку сохранения/проверки."
    ],
    "expected_result": "При использовании файла аудитории с макросом {{balance}} система выдает ошибку о конфликте имен макросов из аудитории и аргументов события. После замены имени макроса в аудитории на {{old_balance}} ошибка не возникает, конфигурация сохраняется.",
    "attributes_covered": [
      "EVT-009"
    ]
  },
  {
    "id": "SCN-006",
    "title": "Использование макросов в действиях: внешняя система и медиа-контент",
    "steps": [
      "Создать рассылку со статической аудиторией.",
      "Добавить блок действия 'Вызов внешней системы'.",
      "В поле 'Адрес (URL)' указать: 'https://api.service.com/users/{{user_id}}/profile'.",
      "В поле 'Заголовки' добавить заголовок 'X-API-Key' со значением '{{api_key}}'.",
      "В поле 'Тело запроса (JSON)' указать: '{\"score\": {{ slots.m.user_score }} }'.",
      "Добавить блок действия 'Медиа-группа'.",
      "Добавить в медиа-группу изображение, в поле 'URL изображения' указать '{{product_image}}'.",
      "Загрузить файл аудитории, содержащий для всех клиентов значения user_id, api_key, user_score, product_image.",
      "Выполнить тестовый запуск или проверку рассылки."
    ],
    "expected_result": "Конфигурация сохраняется без ошибок. При тестовом выполнении для вызова внешней системы URL и заголовок формируются с подстановкой значений {{user_id}} и {{api_key}} из двойных скобок, а тело JSON-запроса содержит вычисленное значение slots.m.user_score. В медиа-группе для каждого клиента загружается изображение по уникальному URL из макроса {{product_image}}.",
    "attributes_covered": [
      "EVT-010",
      "EVT-011",
      "EVT-012",
      "EVT-013"
    ]
  },
  {
    "id": "SCN-007",
    "title": "Проверка граничных условий и специальных возможностей макросов",
    "steps": [
      "Создать рассылку со статической аудиторией.",
      "Добавить медиа-группу и попытаться добавить в неё 51 элемент (изображение/видео), URL которых заданы через макросы (например, {{img_1}} ... {{img_51}}).",
      "Попробовать сохранить конфигурацию.",
      "Удалить лишние элементы, оставив ровно 50.",
      "Попробовать задать значение для макроса типа string, содержащее символ новой строки \\n, через веб-интерфейс конструктора (например, в поле предпросмотра или настройки аудитории).",
      "Проверить, как это значение отображается в тексте сообщения."
    ],
    "expected_result": "Попытка добавить 51-й элемент в медиа-группу блокируется системой с ошибкой. После сокращения до 50 элементов конфигурация сохраняется. Значение макроса с \\n, заданное через веб-интерфейс, либо экранируется (отображается как '\\n' в тексте), либо не поддерживается (не разбивается на строки), в соответствии с документацией.",
    "attributes_covered": [
      "EVT-014",
      "EVT-015"
    ]
  }
]