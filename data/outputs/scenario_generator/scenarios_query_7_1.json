[
  {
    "id": "SCN-001",
    "title": "Создание и удаление макроса через текстовое поле сообщения",
    "steps": [
      "Открыть конструктор рассылок и создать новую рассылку.",
      "В блоке отправки сообщения в поле текста ввести: 'Привет, {{ customer_name }}!'.",
      "Перейти в раздел управления макросами рассылки (или проверить список макросов).",
      "Убедиться, что макрос 'customer_name' появился в списке.",
      "Вернуться к тексту сообщения и удалить введенный текст, включая '{{ customer_name }}'.",
      "Снова проверить список макросов рассылки."
    ],
    "expected_result": "После ввода текста с синтаксисом {{ customer_name }} макрос автоматически создается и отображается в списке. После удаления этого текста из всех полей макрос автоматически удаляется из списка.",
    "attributes_covered": [
      "EVT-001",
      "EVT-002"
    ]
  },
  {
    "id": "SCN-002",
    "title": "Использование макросов разных типов в персонализированном сообщении",
    "steps": [
      "Создать рассылку со статической аудиторией.",
      "Загрузить JSON-файл аудитории, содержащий для клиентов значения макросов разных типов, например: customer_name (string), discount (decimal), birth_date (date), is_vip (boolean), category (categorical).",
      "В тексте сообщения рассылки использовать макросы: 'Уважаемый {{ customer_name }}, ваша скидка {{ discount }}%. Дата рождения: {{ birth_date }}. Статус VIP: {{ is_vip }}. Категория: {{ category }}.'.",
      "Выполнить тестовый запуск рассылки для одного клиента из файла.",
      "Проверить отправленное тестовое сообщение."
    ],
    "expected_result": "В тестовом сообщении значения всех макросов корректно подставлены согласно их типам (например, decimal отображается с десятичной частью, date в правильном формате). Сообщение персонализировано для выбранного клиента.",
    "attributes_covered": [
      "EVT-003",
      "EVT-005",
      "EVT-013",
      "EVT-015"
    ]
  },
  {
    "id": "SCN-003",
    "title": "Проверка обработки строкового макроса с \\n через API и в интерфейсе",
    "steps": [
      "Создать рассылку со статической аудиторией.",
      "Загрузить файл аудитории, где для строкового макроса 'multiline_text' задано значение, содержащее символ \\n (например, 'строка1\\nстрока2').",
      "В тексте сообщения рассылки использовать макрос {{ multiline_text }}.",
      "В интерфейсе конструктора выполнить тестовый вызов (отправку) сообщения для клиента.",
      "Проверить текст в интерфейсе предпросмотра/отправки тестового сообщения.",
      "Отправить рассылку через API (или имитировать через инструменты разработчика) и получить сообщение, доставленное клиенту."
    ],
    "expected_result": "При тестовом вызове из интерфейса в сообщении отображается текст 'строка1\\nстрока2' (символы \\n видны как текст). При отправке через API в полученном клиентом сообщении текст отображается как две строки: 'строка1' и 'строка2'.",
    "attributes_covered": [
      "EVT-004"
    ]
  },
  {
    "id": "SCN-004",
    "title": "Использование макросов в URL и кнопках сообщения",
    "steps": [
      "Создать рассылку со статической аудиторией и загрузить файл с макросами 'user_id' и 'promo_code'.",
      "В блоке сообщения добавить кнопку-ссылку. В поле URL кнопки ввести: 'https://example.com/profile/{{ user_id }}'. В заголовок кнопки ввести: 'Активировать {{ promo_code }}'.",
      "В том же сообщении добавить медиа-контент (изображение). В поле URL изображения ввести: '{{ image_url }}' (предполагается, что image_url также есть в файле аудитории).",
      "Выполнить тестовый запуск рассылки для клиента.",
      "Проверить, что в тестовом сообщении URL кнопки и изображения содержат подставленные значения макросов, а заголовок кнопки также персонализирован."
    ],
    "expected_result": "В тестовом сообщении URL кнопки-ссылки и URL медиа-контента содержат фактические значения макросов (например, 'https://example.com/profile/123'). Заголовок кнопки отображается с подставленным значением макроса (например, 'Активировать SUMMER25').",
    "attributes_covered": [
      "EVT-006",
      "EVT-016"
    ]
  },
  {
    "id": "SCN-005",
    "title": "Использование макросов в действиях 'Вызов внешней системы' и 'Генерация события'",
    "steps": [
      "Создать рассылку со статической аудиторией, содержащей макросы 'user_id', 'customer_name', 'discount'.",
      "Добавить действие 'Вызов внешней системы'.",
      "В поле 'Адрес' ввести: 'https://api.example.com/user/{{ user_id }}'.",
      "В поле 'Текст ошибки' ввести: 'Ошибка для {{ customer_name }}'.",
      "Добавить параметр запроса с ключом 'promo' и значением 'slots.m.discount'.",
      "В поле 'Тело запроса' ввести JSON: '{\"user\": \"slots.m.customer_name\"}'.",
      "Добавить действие 'Генерация события'. В поле аргумента события с ключом 'generated_code' ввести значение 'slots.m.user_id'.",
      "Сохранить рассылку и проверить конфигурацию действий (без запуска)."
    ],
    "expected_result": "Конфигурация действий сохраняется без ошибок. В поле адреса и текста ошибки макросы указаны в синтаксисе {{ }}. В полях значения параметра, тела запроса и аргумента события макросы указаны в синтаксисе 'slots.m.' без фигурных скобок.",
    "attributes_covered": [
      "EVT-007",
      "EVT-008"
    ]
  },
  {
    "id": "SCN-006",
    "title": "Валидация макросов для статической аудитории и проверка запрета для рассылок по тегам",
    "steps": [
      "Создать рассылку с типом аудитории 'Статическая аудитория'.",
      "В тексте сообщения использовать макрос {{ customer_name }}.",
      "Загрузить JSON-файл аудитории, в котором для одного из клиентов отсутствует поле 'customer_name'.",
      "Попытаться запустить рассылку.",
      "Создать новую рассылку с типом аудитории 'По тегам'.",
      "В тексте сообщения попытаться ввести макрос {{ tag_value }}.",
      "Попытаться сохранить или запустить рассылку."
    ],
    "expected_result": "Для статической аудитории система блокирует запуск рассылки и выдает ошибку, что не для всех клиентов задано значение макроса 'customer_name'. Для рассылки по тегам ввод синтаксиса {{ tag_value }} в тексте сообщения вызывает ошибку валидации (или поле не принимает такой ввод), и запуск/сохранение невозможно.",
    "attributes_covered": [
      "EVT-009",
      "EVT-010"
    ]
  },
  {
    "id": "SCN-007",
    "title": "Проверка правил для событийных рассылок и фиксированной аудитории с событием",
    "steps": [
      "Создать событийную рассылку, выбрав событие 'Создание промокода', которое имеет аргументы 'code' и 'discount'.",
      "В тексте сообщения использовать макросы {{ code }} и {{ discount }}.",
      "Попытаться добавить макрос {{ customer_name }} (которого нет в аргументах события).",
      "Сохранить/проверить рассылку.",
      "Создать другую рассылку с типом 'Фиксированная аудитория с событием'.",
      "Загрузить файл аудитории, содержащий макрос 'name'.",
      "Выбрать событие, которое имеет аргумент 'code'.",
      "Попытаться выбрать событие, которое также имеет аргумент 'name' (конфликтующее с макросом аудитории)."
    ],
    "expected_result": "В событийной рассылке можно использовать только макросы {{ code }} и {{ discount }}; попытка использовать {{ customer_name }} вызывает ошибку валидации. Для фиксированной аудитории с событием система разрешает конфигурацию, когда макросы аудитории и аргументы события не пересекаются (например, 'name' и 'code'). При попытке выбрать событие с аргументом 'name' система выдает ошибку конфликта имен.",
    "attributes_covered": [
      "EVT-011",
      "EVT-012"
    ]
  },
  {
    "id": "SCN-008",
    "title": "Использование макросов в различных текстовых полях действий (SMS, перевод в канал)",
    "steps": [
      "Создать рассылку со статической аудиторией, содержащей макросы 'verification_code' и 'customer_name'.",
      "Добавить блок отправки SMS. В тексте SMS ввести: 'Ваш код подтверждения: {{ verification_code }}.'.",
      "Добавить действие 'Перевод в канал'. В тексте сообщения для перевода ввести: 'Клиент {{ customer_name }} переведен в канал поддержки.'.",
      "Выполнить тестовый запуск рассылки.",
      "Проверить содержимое тестового SMS и сообщения при переводе."
    ],
    "expected_result": "В тестовом SMS текст содержит подставленное значение макроса verification_code. В тестовом сообщении действия 'перевод в канал' текст содержит подставленное значение макроса customer_name.",
    "attributes_covered": [
      "EVT-017",
      "EVT-018"
    ]
  },
  {
    "id": "SCN-009",
    "title": "Валидация формата имени макроса и определение значений из аргументов события",
    "steps": [
      "Создать событийную рассылку, выбрав событие 'Промокод активирован' с аргументом 'promo_code'.",
      "В тексте сообщения попытаться ввести макрос с некорректным именем: '{{ промокод! }}'.",
      "Проверить реакцию интерфейса (сохранение, подсветка ошибки).",
      "Исправить текст на корректный макрос: '{{ promo_code }}' (совпадает с аргументом события).",
      "Сымитировать генерацию события с аргументом {'promo_code': 'WINTER30'} (через API или инструменты).",
      "Запустить рассылку (или проверить в логах/тестовом режиме) для этого события."
    ],
    "expected_result": "Ввод макроса с некорректным именем (содержащим кириллицу или символ '!') вызывает ошибку валидации. Корректный макрос {{ promo_code }} принимается. При обработке события значение аргумента 'WINTER30' корректно подставляется в сообщение рассылки.",
    "attributes_covered": [
      "EVT-014",
      "EVT-019"
    ]
  }
]