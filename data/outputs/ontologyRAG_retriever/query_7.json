{
  "query": "макросы в конструкторе рассылок",
  "focus_summary": "Нужно протестировать функциональность использования макросов (динамических подстановок) в конструкторе рассылок. Это включает создание макросов, их типы, определение значений для клиентов, поля, где макросы допустимы, и проверки корректности их использования.",
  "core_passages": [
    {
      "section_id": "section_ch1147",
      "title": "Использование макросов",
      "role": "core",
      "importance": "high",
      "summary": "Макросы позволяют персонифицировать рассылки для клиентов. Значения макросов задаются в файле аудитории (JSON/CSV) для каждого клиента отдельно. Пример: макросы customer_name и customer_discount подставляются в текст рассылки, делая её уникальной для каждого клиента."
    },
    {
      "section_id": "section_ch2133",
      "title": "Приложение Б. Типы макросов",
      "role": "core",
      "importance": "high",
      "summary": "Макросы могут иметь типы: date (дата и время в ISO 8601), decimal (числа, включая вещественные), categorical (фиксированные значения), boolean (логические значения), string (строки). В макросах типа string можно использовать символ \\n для разделения строк, но эта возможность доступна только для API-вызовов."
    },
    {
      "section_id": "section_ch1188",
      "title": "Поля, в которых можно использовать макросы",
      "role": "core",
      "importance": "high",
      "summary": "Макросы можно использовать почти во всех текстовых полях конструктора рассылок: тексты сообщений, заголовки кнопок, URL для кнопок-ссылок и медиа-контента, сообщения при переводе в канал, большинство полей настроек вызова внешней системы, аргументы события при генерации событий, текстовые поля SMS-блока и другие действия."
    },
    {
      "section_id": "section_ch1208",
      "title": "Проверка наличия макросов",
      "role": "core",
      "importance": "high",
      "summary": "Система проверяет наличие макросов, чтобы не допустить запуск рассылки с незаданными или неверными значениями. Правила: для статической аудитории макросы должны быть у всех клиентов; для рассылок по событию можно использовать только макросы, совпадающие с именами аргументов события; для рассылок по тегу или ключевому слову макросы недопустимы; для фиксированной аудитории с событием макросы из аудитории и аргументов не должны пересекаться."
    }
  ],
  "supporting_passages": [
    {
      "section_id": "section_ch1247",
      "title": "Использование макросов в настройках вызова внешней системы и в действии генерации события",
      "role": "supporting",
      "importance": "medium",
      "summary": "В настройках вызова внешней системы и генерации события использование макросов имеет особенности. В полях адреса, текста ошибки и значения заголовка запроса макросы задаются в двойных фигурных скобках. В полях значения параметра запроса, тела запроса и аргументов событий макросы задаются как вычислимые jinja-выражения с приставкой 'slots.m.' (например, slots.m.macros_1)."
    },
    {
      "section_id": "section_ch1206",
      "title": "Создание и удаление макросов рассылки",
      "role": "supporting",
      "importance": "medium",
      "summary": "Макросы создаются неявно при упоминании в одном из допустимых полей конструктора. Макрос состоит из латинских букв, цифр, подчеркивания и обрамляется двойной фигурной скобкой. Удаление макроса происходит, если он удалён из всех текстовых полей рассылки."
    },
    {
      "section_id": "section_ch1217",
      "title": "Определение значений макросов для клиентов",
      "role": "supporting",
      "importance": "medium",
      "summary": "Для рассылок со статической аудиторией значения макросов задаются в JSON или CSV-файлах аудитории. Для рассылок, начинающихся по событию, значения макросов передаются в аргументах события (например, аргументы события 'Создание промокода для клиента' становятся макросами в рассылке)."
    },
    {
      "section_id": "section_ch0125",
      "title": "Блоки действий",
      "role": "supporting",
      "importance": "low",
      "summary": "Блоки действий содержат различные типы действий, такие как отправка сообщений, перевод в канал, вызов внешней системы, генерация событий. В контексте макросов: в тексте сообщений, URL медиа-контента, полях вызова внешней системы и генерации событий можно использовать макросы. Например, в медиа группах можно использовать макросы для динамического задания URL изображений или видео."
    }
  ],
  "discarded_sections": [
    "section_ch0113",
    "section_ch0434"
  ],
  "domain_entities": [
    "Макрос",
    "Рассылка",
    "Клиент",
    "Аудитория",
    "Событие",
    "Аргумент события",
    "Блок действий",
    "Медиа группа",
    "Внешняя система"
  ],
  "hints_for_tests": [
    "Проверить создание макросов через упоминание в текстовых полях и их автоматическое удаление при очистке всех упоминаний.",
    "Проверить подстановку значений макросов разных типов (string, decimal, date, boolean, categorical) в различные поля рассылки.",
    "Проверить валидацию макросов: ошибки при несоответствии макросов в аудитории, при использовании макросов в рассылках по тегу/ключевому слову, при конфликтах макросов из аудитории и аргументов события.",
    "Проверить использование макросов в вызове внешней системы: корректность синтаксиса с двойными фигурными скобками и с приставкой 'slots.m.' для jinja-выражений.",
    "Проверить работу макросов в медиа группах: динамическое задание URL и типов медиа через макросы, ограничение на максимальное количество элементов (50).",
    "Проверить обработку макросов типа string с символом \\n: корректность работы через API и отображение в интерфейсе."
  ]
}