{
  "query": "SMS провайдер",
  "focus_summary": "Нужно протестировать создание и настройку SMS-провайдеров в системе Maxbot, включая корректность ввода параметров для разных типов провайдеров (SMSC, МТС, СМС услуги, SMS.ru), добавление провайдера в рассылку и логику отправки SMS-сообщений. Особое внимание уделить особенностям настройки провайдеров «СМС услуги» и «SMS.ru», а также условиям отправки SMS (флаг failback_to_sms).",
  "core_passages": [
    {
      "section_id": "section_ch0887",
      "title": "Регистрация SMS-провайдера",
      "role": "core",
      "importance": "high",
      "summary": "Описана общая процедура создания SMS-провайдера в Maxbot. Перечислены поддерживаемые провайдеры: SMSC, МТС, СМС услуги, SMS.ru. Указаны обязательные поля для создания: Название, Описание, флаг 'Использовать по умолчанию', Тип провайдера, Логин, Пароль, Отправитель. Отмечено, что для провайдеров 'СМС услуги' и 'SMS.ru' есть особенности, описанные в приложениях."
    },
    {
      "section_id": "section_ch2142",
      "title": "Приложение В. Настройка SMS-провайдера «СМС услуги»",
      "role": "core",
      "importance": "high",
      "summary": "Описаны особенности настройки провайдера 'СМС услуги'. В поле 'Логин' указывается произвольная последовательность символов. В поле 'Пароль' указывается токен из личного кабинета сервиса (раздел API - Рассылка сообщений). В поле 'Отправитель' указывается имя, добавленное в разделе 'Рассылка СМС' - 'Имена отправителя'. Для тестирования можно использовать сообщения 'test' и 'тест'."
    },
    {
      "section_id": "section_ch2162",
      "title": "Приложение Г. Настройка SMS-провайдера «SMS.ru»",
      "role": "core",
      "importance": "high",
      "summary": "Описаны особенности настройки провайдера 'SMS.ru'. В поле 'Отправитель' указывается зарегистрированный в SMS.ru отправитель или номер телефона аккаунта. В поле 'Пароль' указывается 'api_id', который можно получить в разделе 'Программистам' - 'Ваш api_id' личного кабинета."
    },
    {
      "section_id": "section_ch0980",
      "title": "Добавление клиентов",
      "role": "core",
      "importance": "high",
      "summary": "Описаны условия отправки SMS клиентам. Для отправки SMS клиент должен быть добавлен в аудиторию с флагом failback_to_sms = true. Если клиент уже подтвердил номер телефона в мессенджере, ему отправляется обычная рассылка, а не SMS. Для принудительной отправки SMS можно задать пустое поле messengers_order и выставить failback_to_sms = true. Описаны сценарии при подтверждении номера до запуска рассылки и при наличии нескольких мессенджеров."
    }
  ],
  "supporting_passages": [
    {
      "section_id": "section_ch0922",
      "title": "Добавление SMS-провайдера в рассылку",
      "role": "supporting",
      "importance": "medium",
      "summary": "После создания SMS-провайдер может быть добавлен в любую рассылку через раздел 'Условия начала рассылки' - 'Расширенные настройки'. Это позволяет добавить SMS-блок. Упомянута возможность принудительной отправки SMS (даже если клиент подключен к мессенджеру) через настройку файла аудитории: messengers_order пустое и failback_to_sms = True."
    },
    {
      "section_id": "section_ch0931",
      "title": "Использование SMS-блока в конструкторе",
      "role": "supporting",
      "importance": "medium",
      "summary": "После выбора SMS-провайдера в конструкторе рассылки появляется возможность добавить SMS-блок. В рассылке может быть только один SMS-блок, но он может содержать несколько текстовых сообщений и ссылку на посадочную страницу. Клиенты получают либо сообщения в мессенджер, либо только SMS-блок (на основе флага failback_to_sms). Указано, что одно сообщение в конструкторе может быть разделено провайдером на несколько и тарифицироваться соответственно."
    },
    {
      "section_id": "section_ch0948",
      "title": "Настройка посадочных страниц в SMS-блоке",
      "role": "supporting",
      "importance": "medium",
      "summary": "Описана настройка ссылки на посадочную страницу (лендинг) в SMS-блоке для автоматического подтверждения номера телефона в мессенджере. При переходе из SMS диплинк заменяется на диплинк подтверждения. Описаны поля настройки: выбор лендинга, 'Текст до', 'Текст после', время жизни ссылки. Рекомендация использовать 'Текст до/после' для экономии (сообщение идет в одном SMS со ссылкой)."
    },
    {
      "section_id": "section_ch0970",
      "title": "Вызов внешней системы",
      "role": "supporting",
      "importance": "low",
      "summary": "В SMS-блоке возможен вызов внешней системы. Если вызов завершится ошибкой, сообщения в SMS-блоке не будут отправлены. При этом клиенту не отправляется сообщение об ошибке (в отличие от других блоков)."
    },
    {
      "section_id": "section_ch0973",
      "title": "Ограничение на использование профиля и идентификаторов диалога",
      "role": "supporting",
      "importance": "low",
      "summary": "В SMS-блоке существует ограничение на использование профиля клиента и идентификатора диалога (thread_id). Поскольку при отправке SMS клиента в системе еще не существует, обращение к профилю невозможно, кроме одной переменной — {{ profile.phone }}."
    }
  ],
  "discarded_sections": [
    "section_ch0886",
    "section_ch0970"
  ],
  "domain_entities": [
    "SMS-провайдер",
    "Maxbot",
    "Клиент",
    "Аудитория",
    "Рассылка",
    "SMS-блок",
    "Мессенджер",
    "Лендинг",
    "Отправитель",
    "Токен",
    "api_id",
    "failback_to_sms",
    "messengers_order"
  ],
  "hints_for_tests": [
    "Проверить создание SMS-провайдера с разными типами (SMSC, МТС, СМС услуги, SMS.ru) и корректность заполнения полей: Логин, Пароль, Отправитель.",
    "Протестировать особенности настройки для 'СМС услуги' (произвольный логин, токен в пароле) и 'SMS.ru' (отправитель как имя или номер, api_id в пароле).",
    "Проверить логику отправки SMS на основе флага failback_to_sms: когда SMS отправляется, а когда заменяется на мессенджер.",
    "Проверить принудительную отправку SMS через пустое messengers_order и failback_to_sms = true, даже если клиент подтвердил номер в мессенджере.",
    "Проверить добавление SMS-провайдера в рассылку и работу SMS-блока (только один блок, возможность добавления сообщений и лендинга).",
    "Проверить обработку ошибок при вызове внешней системы в SMS-блоке (сообщения не отправляются, но ошибка клиенту не выводится).",
    "Проверить ограничения на использование переменных профиля в SMS-блоке (доступна только profile.phone).",
    "Проверить замену диплинка в лендинге при использовании в SMS-блоке и настройку времени жизни ссылки."
  ]
}