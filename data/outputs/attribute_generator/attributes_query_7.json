[
  {
    "id": "EVT-001",
    "name": "Неявное создание макроса при упоминании",
    "type": "functional",
    "priority": "P1",
    "description": "Макрос должен автоматически создаваться в системе при его первом упоминании в любом допустимом текстовом поле конструктора рассылки.",
    "positive_example": "При вводе текста 'Здравствуйте, {{customer_name}}!' в поле сообщения, макрос 'customer_name' автоматически добавляется в список макросов рассылки.",
    "negative_example": "Макрос 'customer_name' не появляется в списке макросов после его ввода в текстовое поле.",
    "source_section_ids": [
      "section_ch1206"
    ],
    "source_quotes": [
      "Макросы создаются неявно при упоминании в одном из допустимых полей конструктора."
    ]
  },
  {
    "id": "EVT-002",
    "name": "Формат имени макроса",
    "type": "business_rule",
    "priority": "P1",
    "description": "Имя макроса должно состоять только из латинских букв, цифр и символа подчеркивания (_) и быть обрамлено двойными фигурными скобками {{ }}.",
    "positive_example": "Допустимые имена: {{customer_name}}, {{order_id_123}}.",
    "negative_example": "Недопустимые имена: {{клиент-имя}}, {{order.id}}, {customer_name}.",
    "source_section_ids": [
      "section_ch1206"
    ],
    "source_quotes": [
      "Макрос состоит из латинских букв, цифр, подчеркивания и обрамляется двойной фигурной скобкой."
    ]
  },
  {
    "id": "EVT-003",
    "name": "Автоматическое удаление неиспользуемого макроса",
    "type": "functional",
    "priority": "P2",
    "description": "Макрос должен автоматически удаляться из списка макросов рассылки, если он удален из всех текстовых полей, где был использован.",
    "positive_example": "После удаления всех упоминаний {{discount}} из текстов рассылки, этот макропропадает из списка макросов рассылки.",
    "negative_example": "Макрос {{discount}} остается в списке макросов после удаления его из всех текстовых полей.",
    "source_section_ids": [
      "section_ch1206"
    ],
    "source_quotes": [
      "Удаление макроса происходит, если он удалён из всех текстовых полей рассылки."
    ]
  },
  {
    "id": "EVT-004",
    "name": "Поддержка типов макросов",
    "type": "functional",
    "priority": "P1",
    "description": "Система должна поддерживать макросы типов: string, decimal, date (ISO 8601), boolean, categorical.",
    "positive_example": "Макрос {{birth_date}} типа date со значением '2024-01-15T10:30:00Z' корректно подставляется в текст.",
    "negative_example": "Значение 'не дата' для макроса, объявленного как date, вызывает ошибку валидации.",
    "source_section_ids": [
      "section_ch2133"
    ],
    "source_quotes": [
      "Макросы могут иметь типы: date (дата и время в ISO 8601), decimal (числа, включая вещественные), categorical (фиксированные значения), boolean (логические значения), string (строки)."
    ]
  },
  {
    "id": "EVT-005",
    "name": "Подстановка значений макросов из файла аудитории",
    "type": "functional",
    "priority": "P1",
    "description": "Для рассылки со статической аудиторией значения макросов для каждого клиента должны браться из указанного JSON или CSV файла аудитории.",
    "positive_example": "В файле аудитории для клиента A задано customer_name: 'Иван', и в отправленном сообщении отображается 'Здравствуйте, Иван!'.",
    "negative_example": "При отсутствии значения для макроса {{customer_name}} в файле аудитории для клиента, рассылка не запускается или подставляется пустое значение (в зависимости от правил валидации).",
    "source_section_ids": [
      "section_ch1147",
      "section_ch1217"
    ],
    "source_quotes": [
      "Значения макросов задаются в файле аудитории (JSON/CSV) для каждого клиента отдельно.",
      "Для рассылок со статической аудиторией значения макросов задаются в JSON или CSV-файлах аудитории."
    ]
  },
  {
    "id": "EVT-006",
    "name": "Макросы в рассылках по событию",
    "type": "business_rule",
    "priority": "P1",
    "description": "В рассылке, запускаемой по событию, можно использовать только те макросы, имена которых совпадают с именами аргументов этого события.",
    "positive_example": "Событие 'Создание промокода' имеет аргумент 'promo_code'. В рассылке можно использовать макрос {{promo_code}}.",
    "negative_example": "В рассылке по событию 'Создание промокода' используется макрос {{customer_name}}, который не является аргументом события. Это должно вызывать ошибку валидации.",
    "source_section_ids": [
      "section_ch1208"
    ],
    "source_quotes": [
      "для рассылок по событию можно использовать только макросы, совпадающие с именами аргументов события"
    ]
  },
  {
    "id": "EVT-007",
    "name": "Запрет макросов в рассылках по тегу/ключевому слову",
    "type": "negative",
    "priority": "P1",
    "description": "В рассылках, запускаемых по тегу или ключевому слову, использование макросов недопустимо.",
    "positive_example": "Рассылку по тегу 'новый_клиент' можно создать без использования каких-либо макросов.",
    "negative_example": "Попытка создать рассылку по ключевому слову 'скидка' с макросом {{discount_value}} в тексте сообщения должна быть заблокирована системой.",
    "source_section_ids": [
      "section_ch1208"
    ],
    "source_quotes": [
      "для рассылок по тегу или ключевому слову макросы недопустимы"
    ]
  },
  {
    "id": "EVT-008",
    "name": "Проверка полноты значений макросов для статической аудитории",
    "type": "business_rule",
    "priority": "P1",
    "description": "Перед запуском рассылки со статической аудиторией система должна проверять, что для всех используемых макросов заданы значения у каждого клиента в аудитории.",
    "positive_example": "Для всех клиентов в файле аудитории есть столбцы 'name' и 'discount', соответствующие макросам {{name}} и {{discount}}. Рассылка проходит проверку.",
    "negative_example": "У клиента B в файле аудитории отсутствует значение для макроса {{discount}}. Система не позволяет запустить рассылку и выводит ошибку.",
    "source_section_ids": [
      "section_ch1208"
    ],
    "source_quotes": [
      "для статической аудитории макросы должны быть у всех клиентов"
    ]
  },
  {
    "id": "EVT-009",
    "name": "Конфликт макросов в фиксированной аудитории с событием",
    "type": "negative",
    "priority": "P2",
    "description": "В рассылке с фиксированной аудиторией, запускаемой по событию, имена макросов из файла аудитории и имена аргументов события не должны пересекаться.",
    "positive_example": "Аудитория содержит макрос {{client_id}}, событие предоставляет аргумент {{promo_code}}. Конфликта нет.",
    "negative_example": "Аудитория содержит макрос {{code}}, событие также предоставляет аргумент {{code}}. Система должна выдать ошибку о конфликте имен.",
    "source_section_ids": [
      "section_ch1208"
    ],
    "source_quotes": [
      "для фиксированной аудитории с событием макросы из аудитории и аргументов не должны пересекаться"
    ]
  },
  {
    "id": "EVT-010",
    "name": "Использование макросов в текстовых полях конструктора",
    "type": "functional",
    "priority": "P1",
    "description": "Макросы можно использовать почти во всех текстовых полях конструктора рассылок, включая тексты сообщений, заголовки кнопок, URL для кнопок-ссылок и медиа-контента.",
    "positive_example": "Макрос {{product_url}} используется в поле 'URL изображения' медиа-группы, и для каждого клиента подставляется уникальная ссылка.",
    "negative_example": "Попытка использовать макрос в системном поле, не предназначенном для этого (например, ID рассылки), игнорируется или вызывает ошибку.",
    "source_section_ids": [
      "section_ch1188"
    ],
    "source_quotes": [
      "Макросы можно использовать почти во всех текстовых полях конструктора рассылок: тексты сообщений, заголовки кнопок, URL для кнопок-ссылок и медиа-контента, сообщения при переводе в канал, большинство полей настроек вызова внешней системы, аргументы события при генерации событий, текстовые поля SMS-блока и другие действия."
    ]
  },
  {
    "id": "EVT-011",
    "name": "Синтаксис макросов в вызове внешней системы (стандартные поля)",
    "type": "functional",
    "priority": "P2",
    "description": "В полях адреса, текста ошибки и значения заголовка запроса при вызове внешней системы макросы должны задаваться в двойных фигурных скобках {{ }}.",
    "positive_example": "URL вызова: 'https://api.example.com/user/{{user_id}}'. Заголовок: 'X-Token: {{api_token}}'.",
    "negative_example": "Использование синтаксиса slots.m.user_id в поле адреса приводит к ошибке или некорректному формированию запроса.",
    "source_section_ids": [
      "section_ch1247"
    ],
    "source_quotes": [
      "В полях адреса, текста ошибки и значения заголовка запроса макросы задаются в двойных фигурных скобках."
    ]
  },
  {
    "id": "EVT-012",
    "name": "Синтаксис макросов в вызове внешней системы (Jinja-выражения)",
    "type": "functional",
    "priority": "P2",
    "description": "В полях значения параметра запроса, тела запроса и аргументов событий при вызове внешней системы или генерации события макросы должны задаваться как вычислимые jinja-выражения с приставкой 'slots.m.'.",
    "positive_example": "Тело запроса в формате JSON: '{\"id\": {{ slots.m.user_id }}, \"amount\": {{ slots.m.order_amount }} }'.",
    "negative_example": "Использование синтаксиса {{user_id}} в теле JSON-запроса приводит к тому, что в запрос подставляется строка '{{user_id}}', а не её значение.",
    "source_section_ids": [
      "section_ch1247"
    ],
    "source_quotes": [
      "В полях значения параметра запроса, тела запроса и аргументов событий макросы задаются как вычислимые jinja-выражения с приставкой 'slots.m.' (например, slots.m.macros_1)."
    ]
  },
  {
    "id": "EVT-013",
    "name": "Динамические URL в медиа-группах через макросы",
    "type": "functional",
    "priority": "P2",
    "description": "В медиа-группах можно использовать макросы для динамического задания URL изображений или видео для каждого клиента.",
    "positive_example": "В поле 'URL изображения' задано '{{personal_image_url}}'. Для клиента А подставляется 'https://cdn.com/a.jpg', для клиента B - 'https://cdn.com/b.jpg'.",
    "negative_example": "URL, заданный макросом, возвращает ошибку 404, и изображение не отображается в сообщении для клиента.",
    "source_section_ids": [
      "section_ch0125"
    ],
    "source_quotes": [
      "В медиа группах можно использовать макросы для динамического задания URL изображений или видео."
    ]
  },
  {
    "id": "EVT-014",
    "name": "Ограничение на количество элементов в медиа-группе",
    "type": "business_rule",
    "priority": "P3",
    "description": "Медиа-группа может содержать не более 50 элементов (например, изображений или видео).",
    "positive_example": "Создана медиа-группа с 30 изображениями, URL которых заданы через макросы.",
    "negative_example": "Попытка добавить 51-й элемент в медиа-группу блокируется системой.",
    "source_section_ids": [
      "section_ch0125"
    ],
    "source_quotes": [
      "ограничение на максимальное количество элементов (50)."
    ]
  },
  {
    "id": "EVT-015",
    "name": "Обработка символа новой строки в макросах типа string",
    "type": "functional",
    "priority": "P3",
    "description": "В макросах типа string можно использовать символ \\n для обозначения переноса строки, но эта возможность доступна только при задании значений через API.",
    "positive_example": "Через API задано значение макроса {{message}}: 'Первая строка\\nВторая строка'. В тексте рассылки это отображается как две строки.",
    "negative_example": "Попытка ввести значение с \\n через веб-интерфейс конструктора может не поддерживаться или экранироваться.",
    "source_section_ids": [
      "section_ch2133"
    ],
    "source_quotes": [
      "В макросах типа string можно использовать символ \\n для разделения строк, но эта возможность доступна только для API-вызовов."
    ]
  }
]