[
  {
    "id": "EVT-001",
    "name": "Неявное создание макроса при упоминании",
    "type": "functional",
    "priority": "P1",
    "description": "Макрос должен автоматически создаваться при его первом упоминании в текстовом поле рассылки в формате двойных фигурных скобок.",
    "positive_example": "Ввод текста 'Привет, {{ customer_name }}!' в поле сообщения создает макрос customer_name.",
    "negative_example": "Ввод текста 'Привет, {{ customer_name }}!' не приводит к появлению макроса customer_name в списке макросов рассылки.",
    "source_section_ids": [
      "section_ch1204"
    ],
    "source_quotes": [
      "Макросы создаются неявно при упоминании в текстовых полях рассылки и состоят из латинских букв, цифр, подчеркивания в двойных фигурных скобках."
    ]
  },
  {
    "id": "EVT-002",
    "name": "Автоматическое удаление неиспользуемого макроса",
    "type": "functional",
    "priority": "P2",
    "description": "Макрос должен автоматически удаляться из списка макросов рассылки, если его упоминание убрано из всех текстовых полей.",
    "positive_example": "После удаления всех вхождений '{{ abc }}' из полей рассылки макрос abc исчезает из списка.",
    "negative_example": "Макрос abc остается в списке после удаления всех его упоминаний из текстовых полей.",
    "source_section_ids": [
      "section_ch1204"
    ],
    "source_quotes": [
      "Удаляются, если убрать из всех полей."
    ]
  },
  {
    "id": "EVT-003",
    "name": "Поддержка типов макросов",
    "type": "functional",
    "priority": "P1",
    "description": "Система должна поддерживать макросы типов: date, decimal, categorical, boolean, string.",
    "positive_example": "Макрос discount типа decimal со значением 15.5 корректно подставляется в сообщение.",
    "negative_example": "Система не распознает тип date для макроса birth_date и не форматирует его значение.",
    "source_section_ids": [
      "section_ch2133"
    ],
    "source_quotes": [
      "Макросы могут иметь типы: date, decimal, categorical, boolean, string."
    ]
  },
  {
    "id": "EVT-004",
    "name": "Обработка строковых макросов с символом новой строки через API",
    "type": "functional",
    "priority": "P3",
    "description": "Для строковых макросов символ \\n должен интерпретироваться как разделитель строк при использовании через API, но при тестовом вызове из интерфейса клиент должен видеть \\n как текст.",
    "positive_example": "Через API макрос с значением 'строка1\\nстрока2' отображается как две строки. В интерфейсе при тестовом вызове отображается 'строка1\\nстрока2'.",
    "negative_example": "В интерфейсе при тестовом вызове символ \\n преобразуется в перенос строки, а не отображается как текст.",
    "source_section_ids": [
      "section_ch2133"
    ],
    "source_quotes": [
      "Для строковых макросов можно использовать символ \\n для разделения строк, но эта возможность доступна только через API; при тестовом вызове из интерфейса клиент получит \\n в тексте как есть."
    ]
  },
  {
    "id": "EVT-005",
    "name": "Использование макросов в текстовых полях сообщений",
    "type": "ui",
    "priority": "P1",
    "description": "Макросы должны быть доступны для использования в текстах сообщений в конструкторе рассылок.",
    "positive_example": "В тексте сообщения можно написать 'Скидка {{ discount }}% для {{ customer_name }}'.",
    "negative_example": "Поле для текста сообщения не принимает синтаксис {{ макрос }} или выдает ошибку.",
    "source_section_ids": [
      "section_ch1188"
    ],
    "source_quotes": [
      "Макросы можно использовать почти во всех текстовых полях конструктора рассылок: тексты сообщений"
    ]
  },
  {
    "id": "EVT-006",
    "name": "Использование макросов в URL кнопок-ссылок и медиа-контента",
    "type": "functional",
    "priority": "P1",
    "description": "Макросы должны быть доступны для подстановки в URL для кнопок-ссылок и URL медиа-контента.",
    "positive_example": "URL кнопки-ссылки: 'https://example.com/profile/{{ user_id }}'. URL изображения: '{{ image_url }}'.",
    "negative_example": "Система не подставляет значение макроса в URL, оставляя '{{ image_url }}' как текст.",
    "source_section_ids": [
      "section_ch1188"
    ],
    "source_quotes": [
      "URL для кнопок-ссылок и медиа-контента"
    ]
  },
  {
    "id": "EVT-007",
    "name": "Использование макросов в настройках вызова внешней системы (адрес, заголовки, ошибка)",
    "type": "functional",
    "priority": "P2",
    "description": "В полях адреса, текста ошибки и значения заголовка при вызове внешней системы макросы должны задаваться в двойных фигурных скобках.",
    "positive_example": "Адрес: 'https://api.example.com/user/{{ user_id }}'. Текст ошибки: 'Ошибка для {{ customer_name }}'.",
    "negative_example": "Ввод '{{ user_id }}' в поле адреса не распознается как макрос и вызывает ошибку валидации.",
    "source_section_ids": [
      "section_ch1247"
    ],
    "source_quotes": [
      "В настройках вызова внешней системы макросы в полях адреса, текста ошибки и значения заголовка задаются в двойных фигурных скобках."
    ]
  },
  {
    "id": "EVT-008",
    "name": "Использование макросов в параметрах запроса и теле запроса внешней системы",
    "type": "functional",
    "priority": "P2",
    "description": "В полях значения параметра запроса, тела запроса и аргументов событий макросы должны задаваться как jinja-выражения с приставкой 'slots.m.' без скобок.",
    "positive_example": "Параметр запроса: ключ 'discount', значение 'slots.m.discount'. Тело запроса: '{\"user\": \"slots.m.name\"}'.",
    "negative_example": "Использование синтаксиса {{ discount }} в поле значения параметра запроса приводит к ошибке.",
    "source_section_ids": [
      "section_ch1247"
    ],
    "source_quotes": [
      "В полях значения параметра запроса, тела запроса и аргументов событий макросы задаются как jinja-выражения с приставкой 'slots.m.' без скобок."
    ]
  },
  {
    "id": "EVT-009",
    "name": "Проверка наличия значений макросов для статической аудитории",
    "type": "business_rule",
    "priority": "P1",
    "description": "Для рассылки со статической аудиторией система должна проверять, что значения макросов заданы для всех клиентов в файле аудитории, и не допускать запуск, если есть клиенты без значений.",
    "positive_example": "В JSON-файле аудитории для каждого клиента есть поле 'customer_name'. Рассылка запускается.",
    "negative_example": "У одного клиента в файле аудитории отсутствует значение для макроса customer_name. Система блокирует запуск рассылки.",
    "source_section_ids": [
      "section_ch1208"
    ],
    "source_quotes": [
      "для статической аудитории макросы должны быть у всех клиентов"
    ]
  },
  {
    "id": "EVT-010",
    "name": "Запрет макросов для рассылок по тегам или ключевым словам",
    "type": "business_rule",
    "priority": "P1",
    "description": "Для рассылок, нацеленных на аудиторию по тегам или ключевым словам, использование макросов недопустимо.",
    "positive_example": "При выборе типа аудитории 'по тегам' поля для загрузки файла с макросами недоступны, а ввод {{ макрос }} в тексте сообщения вызывает ошибку валидации.",
    "negative_example": "В рассылке по тегам можно добавить макрос {{ tag_value }} и система пытается его обработать.",
    "source_section_ids": [
      "section_ch1208"
    ],
    "source_quotes": [
      "для рассылок по тегам или ключевым словам макросы недопустимы"
    ]
  },
  {
    "id": "EVT-011",
    "name": "Совпадение макросов с аргументами события для событийных рассылок",
    "type": "business_rule",
    "priority": "P1",
    "description": "В событийных рассылках можно использовать только те макросы, которые совпадают с аргументами события, переданными при его генерации.",
    "positive_example": "Событие 'Промокод' с аргументом 'code'. В рассылке можно использовать макрос {{ code }}.",
    "negative_example": "В событийной рассылке используется макрос {{ discount }}, но событие не имеет такого аргумента. Система блокирует запуск.",
    "source_section_ids": [
      "section_ch1208"
    ],
    "source_quotes": [
      "для событийных рассылок можно использовать только макросы, совпадающие с аргументами события"
    ]
  },
  {
    "id": "EVT-012",
    "name": "Непересечение макросов аудитории и события в фиксированной аудитории с событием",
    "type": "business_rule",
    "priority": "P2",
    "description": "Для рассылок с фиксированной аудиторией и событием макросы из файла аудитории и аргументы события не должны пересекаться (иметь одинаковые имена).",
    "positive_example": "Аудитория содержит макрос 'name', событие содержит аргумент 'code'. Рассылка может быть создана.",
    "negative_example": "И аудитория, и событие содержат макрос/аргумент с именем 'discount'. Система выдает ошибку конфликта.",
    "source_section_ids": [
      "section_ch1208"
    ],
    "source_quotes": [
      "для фиксированной аудитории с событием макросы из аудитории и события не могут пересекаться"
    ]
  },
  {
    "id": "EVT-013",
    "name": "Определение значений макросов из файла аудитории",
    "type": "functional",
    "priority": "P1",
    "description": "Для рассылок со статической аудиторией значения макросов должны задаваться через JSON или CSV-файл, где для каждого клиента указаны соответствующие данные.",
    "positive_example": "Загружается JSON-файл: [{\"customer_id\": \"1\", \"customer_name\": \"Иван\"}, ...]. Значение {{ customer_name }} подставляется для каждого клиента.",
    "negative_example": "Система не читает значения макросов из загруженного CSV-файла, оставляя подстановки пустыми.",
    "source_section_ids": [
      "section_ch1217"
    ],
    "source_quotes": [
      "Для рассылок со статической аудиторией значения макросов задаются в JSON или CSV-файлах аудитории."
    ]
  },
  {
    "id": "EVT-014",
    "name": "Определение значений макросов из аргументов события",
    "type": "functional",
    "priority": "P1",
    "description": "Для рассылок по событию значения макросов должны браться из аргументов события, переданных при его генерации.",
    "positive_example": "Событие 'Создание промокода' с аргументами {'code': 'SUMMER25', 'discount': 15}. В рассылке {{ code }} подставляется как 'SUMMER25'.",
    "negative_example": "Аргумент события 'code' не подставляется в макрос {{ code }} в сообщении рассылки.",
    "source_section_ids": [
      "section_ch1217"
    ],
    "source_quotes": [
      "Для рассылок по событию значения передаются в аргументах события, которые становятся макросами в рассылке."
    ]
  },
  {
    "id": "EVT-015",
    "name": "Персонализация сообщений для разных клиентов",
    "type": "functional",
    "priority": "P1",
    "description": "В одной рассылке разные клиенты должны получать сообщения с подстановкой их уникальных значений макросов из файла аудитории или аргументов события.",
    "positive_example": "Клиент А получает 'Привет, Иван!', клиент Б получает 'Привет, Мария!' благодаря макросу {{ customer_name }}.",
    "negative_example": "Все клиенты получают одинаковое сообщение 'Привет, {{ customer_name }}!' без подстановки.",
    "source_section_ids": [
      "section_ch1147"
    ],
    "source_quotes": [
      "После запуска клиенты получают персонализированные сообщения с подстановкой значений."
    ]
  },
  {
    "id": "EVT-016",
    "name": "Использование макросов в заголовках кнопок",
    "type": "ui",
    "priority": "P2",
    "description": "Макросы должны быть доступны для использования в тексте заголовков кнопок в конструкторе рассылок.",
    "positive_example": "Заголовок кнопки: 'Использовать промокод {{ code }}'.",
    "negative_example": "Поле заголовка кнопки не позволяет ввести синтаксис {{ code }} или сбрасывает его.",
    "source_section_ids": [
      "section_ch1188"
    ],
    "source_quotes": [
      "заголовки кнопок"
    ]
  },
  {
    "id": "EVT-017",
    "name": "Использование макросов в сообщениях при переводе в канал",
    "type": "functional",
    "priority": "P2",
    "description": "Макросы должны быть доступны для использования в текстовых полях сообщения, отправляемого при действии перевода в канал.",
    "positive_example": "Сообщение при переводе: 'Клиент {{ customer_name }} переведен в канал поддержки.'",
    "negative_example": "Поле сообщения для действия 'перевод в канал' не поддерживает синтаксис макросов.",
    "source_section_ids": [
      "section_ch1188"
    ],
    "source_quotes": [
      "сообщения при переводе в канал"
    ]
  },
  {
    "id": "EVT-018",
    "name": "Использование макросов в текстовых полях SMS-блока",
    "type": "functional",
    "priority": "P2",
    "description": "Макросы должны быть доступны для использования в текстовых полях блока отправки SMS.",
    "positive_example": "Текст SMS: 'Ваш код подтверждения: {{ verification_code }}'.",
    "negative_example": "Поле текста SMS не принимает макросы, оставляя '{{ verification_code }}' как есть.",
    "source_section_ids": [
      "section_ch1188"
    ],
    "source_quotes": [
      "текстовые поля SMS-блока"
    ]
  },
  {
    "id": "EVT-019",
    "name": "Валидация формата имени макроса",
    "type": "negative",
    "priority": "P3",
    "description": "Имя макроса должно состоять только из латинских букв, цифр и подчеркивания. Использование других символов должно вызывать ошибку.",
    "positive_example": "Имена макросов: 'customer_name', 'discount_2024'.",
    "negative_example": "Ввод '{{ имя-клиента }}' или '{{ discount! }}' вызывает ошибку валидации.",
    "source_section_ids": [
      "section_ch1204"
    ],
    "source_quotes": [
      "состоят из латинских букв, цифр, подчеркивания"
    ]
  }
]